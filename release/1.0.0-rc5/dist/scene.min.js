/*
Copyright (c) 2017 Daybrush
name: scenejs
license: MIT
author: Daybrush
repository: https://github.com/daybrush/scenejs.git
version: 1.0.0-rc5
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).Scene=e()}(this,function(){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function a(t,e){function n(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var t,F="__SCENEJS_",l="data-scene-id",v="animation-timing-function",p={transform:{},filter:{},attribute:{}},c={easing:[v]},o=((t={})[v]=!0,t.contents=!0,t),e=1e6,d=1e-6,b="duration",I="fillMode",C="direction",O="iterationCount",_="delay",N="easing",A="playSpeed",M="easingName",f="paused",u="ended",h="timeupdate",m="play",g="running",y="iteration",j="startAnimation",P="pauseAnimation",E="alternate",w="reverse",x="alternate-reverse",U="infinite",S="playState",n="playCSS",T="prevTime",D="tickTime",z="currentTime",R="selector",k="transform",L=[b,I,C,O,_,N,A],r=[f,u,h,"animate",m,y],V="rgb",$="rgba",q="hsl",K="hsla",Z=[V,$,q,K],Y="function",H="property",J="array",B="object",s="string",G="number",Q="undefined",W=typeof window!==Q,X=typeof document!==Q&&document,tt=["webkit","ms","moz","o"],et=function(t){if(!X)return"";var e=(X.body||X.documentElement).style,n=tt.length;if(typeof e[t]!==Q)return t;for(var i=0;i<n;++i){var r="-"+tt[i]+"-"+t;if(typeof e[r]!==Q)return r}return""},nt=et("transform"),it=et("filter"),rt=et("animation"),st=rt.replace("animation","keyframes");function at(t){return typeof t===Q}function ot(t){return t&&typeof t===B}function ut(t){return Array.isArray(t)}function ft(t){return typeof t===s}function ht(t){return typeof t===Y}function ct(t){var e=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g);return e?e.map(function(t){return t.trim()}):[]}function lt(t){var e=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(t);return!e||e.length<4?{}:{prefix:e[1],value:e[2],suffix:e[3]}}function vt(t){var e=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!e)return{prefix:"",unit:"",value:NaN};var n=e[1],i=e[2];return{prefix:n,unit:e[3],value:parseFloat(i)}}function pt(t){return t.replace(/[\s-_]([a-z])/g,function(t,e){return e.toUpperCase()})}function mt(t,i){return void 0===i&&(i="-"),t.replace(/([a-z])([A-Z])/g,function(t,e,n){return""+e+i+n.toLowerCase()})}function dt(t){return[].slice.call(t)}function gt(){return Date.now?Date.now():(new Date).getTime()}var yt=function(){var n=gt(),t=W&&(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame);return t?t.bind(window):function(t){var e=gt();return window.setTimeout(function(){t(e-n)},1e3/60)}}();function St(t){var e=t.replace("#",""),n=parseInt(e.substring(0,2),16),i=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16),s=parseInt(e.substring(6,8),16)/255;return isNaN(s)&&(s=1),[n,i,r,s]}function Et(t){if("#"===t.charAt(0))return 4===t.length||5===t.length?St((f=(u=t).charAt(1),h=u.charAt(2),c=u.charAt(3),l=u.charAt(4),["#",f,f,h,h,c,c,l,l].join(""))):St(t);if(-1!==t.indexOf("(")){var e=lt(t),n=e.prefix,i=e.value;if(!n||!i)return;var r=ct(i),s=[],a=r.length;switch(n){case V:case $:for(var o=0;o<a;++o)s[o]=parseFloat(r[o]);return s;case q:case K:for(o=0;o<a;++o)-1!==r[o].indexOf("%")?s[o]=parseFloat(r[o])/100:s[o]=parseFloat(r[o]);return function(t){var e=t[0],n=t[1],i=t[2];e<0&&(e+=360*Math.floor((Math.abs(e)+360)/360)),e%=360;var r,s=(1-Math.abs(2*i-1))*n,a=s*(1-Math.abs(e/60%2-1)),o=i-s/2;return e<60?r=[s,a,0]:e<120?r=[a,s,0]:e<180?r=[0,s,a]:e<240?r=[0,a,s]:e<300?r=[a,0,s]:e<360&&(r=[s,0,a]),[Math.round(255*(r[0]+o)),Math.round(255*(r[1]+o)),Math.round(255*(r[2]+o)),3<t.length?t[3]:1]}(s)}}var u,f,h,c,l}function wt(t,e){return e?X.querySelectorAll(t):X.querySelector(t)}function xt(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function Tt(t,e){if(t.classList)t.classList.remove(e);else{var n=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(n," ")}}function Dt(t,e,n,i){t.addEventListener(e,n,i)}function Ft(t,e,n){t.removeEventListener(e,n)}var bt=function(){function t(){this.events={}}var e=t.prototype;return e._on=function(i,r,e){var n=this,t=this.events;if(ot(i))for(var s in i)this._on(s,i[s],e);else i in t||(t[i]=[]),r&&(ut(r)?r.forEach(function(t){return n._on(i,t,e)}):t[i].push(e?function t(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];r.apply(void 0,e),this.off(i,t)}:r))},e.on=function(t,e){return this._on(t,e),this},e.off=function(t,e){if(t)if(e){var n=this.events[t];if(!n)return this;var i=n.indexOf(e);-1!==i&&n.splice(i,1)}else this.events[t]=[];else this.events={};return this},e.trigger=function(t){for(var e=this,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];var r=this.events;if(!(t in r))return this;var s=n||[];!s[0]&&(s[0]={});r[t];var a=s[0];return a.type=t,a.currentTarget=this,!a.target&&(a.target=this),dt(r[t]).forEach(function(t){t.apply(e,n)}),this},e.once=function(t,e){return this._on(t,e,!0),this},t}();function It(t,e,n){var i=1-n;return n*n*n+3*n*n*i*e+3*n*i*i*t}function Ct(n,i,r,s){var t=function(t){var e=function(t,e,n){for(var i=n,r=1;.001<Math.abs(r);){if(r=It(t,e,i)-n,Math.abs(r)<.001)return i;i-=r/2}return i}(n,r,Math.max(Math.min(1,t),0));return It(i,s,e)};return t.easingName="cubic-bezier("+n+","+i+","+r+","+s+")",t}function Ot(n,i){var t=function(t){var e=1/n;return 1<=t?1:("start"===i?e:0)+Math.floor(t/e)*e};return t.easingName="steps("+n+", "+i+")",t}var _t=Ot(1,"start"),Nt=Ot(1,"end"),At=Ct(0,0,1,1),Mt=Ct(.25,.1,.25,1),jt=Ct(.42,0,1,1),Pt=Ct(0,0,.58,1),Ut=Ct(.42,0,.58,1),zt=function(){function a(t,e){this.prefix="",this.suffix="",this.model="",this.type="",this.separator=",",e&&this.setOptions(e),this.value=ft(t)?t.split(this.separator):t}var t=a.prototype;return t.setOptions=function(t){for(var e in t)this[e]=t[e];return this},t.size=function(){return this.value.length},t.get=function(t){return this.value[t]},t.set=function(t,e){return this.value[t]=e,this},t.clone=function(){var t=this,e=t.separator,n=t.prefix,i=t.suffix,r=t.model,s=t.type;return new a(this.value.map(function(t){return t instanceof a?t.clone():t}),{separator:e,prefix:n,suffix:i,model:r,type:s})},t.toValue=function(){return this.prefix+this.join()+this.suffix},t.join=function(){return this.value.map(function(t){return t instanceof a?t.toValue():t}).join(this.separator)},t.forEach=function(t){return this.value.forEach(t),this},a}();function Rt(t){return t instanceof zt}function kt(t){var e=typeof t;if(e===B){if(ut(t))return J;if(Rt(t))return H}else if(e===s||e===G)return"value";return e}function Lt(t){return Math.round(t*e)/e}function Vt(t,e,n){void 0===n&&(n=t.length);for(var i=e,r=0;r<n;++r){if(!ot(i))return;i=i[t[r]]}return i}function $t(t,e,n){var i=e.length,r=t;if(0===i)return!1;for(var s=0;s<i;++s){if(!0===r)return!1;if(!(r=r[e[s]])||!n&&!0===r)return!1}return!0}function qt(t,e){return $t(p,t,e)}function Kt(t){return $t(o,t,!0)}function Zt(t,e){t.state[n]=e}function Yt(t){return t.state[n]&&t.isPaused()}function Ht(t){return!t.isEnded()&&t.state[n]}function Jt(t,e){var n=F+"STYLE_"+Qt(t),i=wt("#"+n);i?i.innerText=e:X.body.insertAdjacentHTML("beforeend",'<style id="'+n+'">'+e+"</style>")}function Bt(t){for(;;){var e=""+Math.floor(1e7*Math.random());if(!W||!t)return e;if(!wt('[data-scene-id="'+e+'"]'))return e}}function Gt(t){return t.getId()||t.setId(Bt(!1)).getId()}function Qt(t){return(""+t).match(/[0-9a-zA-Z]+/g).join("")}function Wt(t,e,n,i){if(void 0===i&&(i={}),rt&&t.getPlayState()!==g){var r=n||j;if(Yt(t))t.addPlayClass(!0,r,i);else{t.isEnded()&&t.setTime(0),e&&t.exportCSS({className:r});var s=t.addPlayClass(!1,r,i);if(!s)return;!function(r,t){var s=r.state,a=r.getDuration(),o=!a||!isFinite(a),e=function(){Zt(r,!1),r.finish()},n=function(){r.trigger(m)};r.once(u,function(){Ft(t,"animationcancel",e),Ft(t,"animationend",e),Ft(t,"animationiteration",i),Ft(t,"animationstart",n)});var i=function(t){var e=t.elapsedTime,n=e,i=o?0:n/a;s[z]=n,r.setIteration(i)};Dt(t,"animationcancel",e),Dt(t,"animationend",e),Dt(t,"animationiteration",i),Dt(t,"animationstart",n)}(t,s),Zt(t,!0)}t.setPlayState(g)}}function Xt(t,e,n){void 0===n&&(n=-1);for(var i=t.length,r=0;r<i;++r)if(e(t[r]))return r;return n}function te(t,e,n){return n===w||(e!==U&&t===e&&e%1==0?n===(1<=t%2?x:E):n===(1<=t%2?E:x))}var ee=["id",O,_,I,C,A,b,A,"iterationTime",S],ne=ee.concat([N,M]),ie=function(n){function t(t){var e=n.call(this)||this;return e.state={id:"",easing:0,easingName:"linear",iterationCount:1,delay:0,fillMode:"forwards",direction:"normal",playSpeed:1,currentTime:0,iterationTime:-1,iteration:0,tickTime:0,prevTime:0,playState:f,duration:0},e.setOptions(t),e}a(t,n);var e,i,r,s=t.prototype;return s.setEasing=function(t){var e=ut(t)?Ct(t[0],t[1],t[2],t[3]):t,n=e[M]||"linear",i=this.state;return i[N]=e,i[M]=n,this},s.setOptions=function(t){for(var e in void 0===t&&(t={}),t){var n=t[e];e!==N?e!==b?-1<L.indexOf(e)&&(this.state[e]=n):n&&this.setDuration(n):this.setEasing(n)}return this},s.getTotalDuration=function(){return this.getActiveDuration(!0)},s.getActiveDuration=function(t){var e=this.state,n=e[O];return n===U?1/0:(t?e[_]:0)+this.getDuration()*n},s.isEnded=function(){return 0===this.state[D]&&this.state[S]===f||!(this.getTime()<this.getActiveDuration())},s.isPaused=function(){return this.state[S]===f},s.start=function(t){void 0===t&&(t=this.state[_]);var e=this.state;e[S]=g,e[D]>=t&&this.trigger(m)},s.play=function(e){var n=this,i=this.state,t=i[_],r=this.getTime();return i[S]=g,this.isEnded()&&(0===r||r>=this.getActiveDuration())&&this.setTime(-t,!0),i[D]=this.getTime(),yt(function(t){i[T]=t,function e(n,t,i){if(!n.isPaused()){var r=n.state,s=r[A],a=r[T],o=r[_],u=r[D]+Math.min(1e3,t-a)/1e3*s;r[T]=t,n.setTime(u-o,!0),i&&1e3*i<t&&n.pause(),r[S]!==f&&yt(function(t){e(n,t,i)})}}(n,t,e)}),this.start(),this},s.pause=function(){var t=this.state;return t[S]!==f&&(t[S]=f,this.trigger(f)),this},s.finish=function(){return this.setTime(0),this.state[D]=0,this.end(),this},s.end=function(){return this.pause(),this.trigger(u),this},s.setTime=function(t,e){var n=this.getActiveDuration(),i=this.state,r=i[D],s=i[_],a=e?t:this.getUnitTime(t);if(i[D]=s+a,a<0?a=0:n<a&&(a=n),i[z]=a,this.calculate(),e){var o=i[D];if((r<s&&0<=t||i[S]!==g&&s<=o&&!this.isEnded())&&this.start(0),o<r||this.isEnded())return void this.end()}return this.isDelay()||this.trigger(h,{currentTime:a,time:this.getIterationTime(),iterationCount:i[y]}),this},s.getTime=function(){return this.state[z]},s.getUnitTime=function(t){if(ft(t)){var e=this.getDuration()||100;if("from"===t)return 0;if("to"===t)return e;var n=vt(t),i=n.unit,r=n.value;return"%"===i?(!this.getDuration()&&(this.state[b]=e),Lt(parseFloat(t)/100*e)):">"===i?r+d:r}return Lt(t)},s.isDelay=function(){var t=this.state,e=t[_],n=t[D];return 0<e&&n<e},s.setIteration=function(t){var e=this.state,n=Math.floor(t),i=e[O]===U?1/0:e[O];return e[y]<n&&n<i&&this.trigger("iteration",{currentTime:e[z],iterationCount:n}),e[y]=t,this},s.calculate=function(){var t=this.state,e=t[O],n=t[I],i=t[C],r=this.getDuration(),s=this.getTime(),a=0===r?0:s/r,o=r?s%r:0;if(!r)return this.setIterationTime(0),this;this.setIteration(a);var u=te(a,e,i),f=isFinite(r);(f&&u&&(o=r-o),f&&e!==U)&&(e<=a&&(o=r*("both"===n||"forwards"===n?e%1||1:0),u&&(o=r-o)));return this.setIterationTime(o),this},t=function(t,e,n,i){var r,s=arguments.length,a=s<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,n):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,n,i);else for(var o=t.length-1;0<=o;o--)(r=t[o])&&(a=(s<3?r(a):3<s?r(e,n,a):r(e,n))||a);return 3<s&&a&&Object.defineProperty(e,n,a),a}([(e=ne,i=ee,r="state",function(t){var n=t.prototype;e.forEach(function(t){n[pt("get "+t)]=function(){return this[r][t]}}),i.forEach(function(e){n[pt("set "+e)]=function(t){return this[r][e]=t,this}})})],t)}(bt);function re(t){var e=$;return 3===t.length&&(t[3]=1),new zt(t,{model:e,separator:",",type:"color",prefix:e+"(",suffix:")"})}function se(t,e){return new zt(t,{type:"array",separator:e})}function ae(t){if(!ft(t))return ut(t)?se(t,","):t;var e,n,i=ct(t);return 1<i.length?se(i.map(function(t){return ae(t)}),","):1<(i=t.match(/("[^"]*")|('[^']*')|([^\s()]*(?:\((?:[^()]*|\([^()]*\))*\))[^\s()]*)|\S+/g)||[]).length?se(i.map(function(t){return ae(t)})," "):(i=/^(['"])([^'"]*)(['"])$/g.exec(t))&&i[1]===i[3]?new zt([ae(i[2])],{prefix:i[1],suffix:i[1]}):-1!==t.indexOf("(")?function(t){var e=lt(t),n=e.prefix,i=e.value,r=e.suffix;if(void 0===i)return t;if(-1!==Z.indexOf(n))return re(Et(t));var s=ae(i),a=[i],o=",",u=n+"(",f=")"+r;return s instanceof zt&&(o=s.separator,a=s.value,u+=s.prefix,f=s.suffix+f),new zt(a,{separator:o,model:n,prefix:u,suffix:f})}(t):"#"===t.charAt(0)?(n=Et(e=t))?re(n):e:t}function oe(t){if(!t)return"";var e=[];for(var n in t)e.push(n.replace(/\d/g,"")+"("+t[n]+")");return e.join(" ")}function ue(t,e){return void 0===e&&(e=!1),fe({},t,e)}function fe(t,e,n){for(var i in void 0===n&&(n=!1),e){var r=e[i],s=kt(r);s===H?t[i]=n?r.toValue():r.clone():s===Y?t[i]=n?ce([i],r):r:s===J?t[i]=r.slice():s===B?ot(t[i])&&!Rt(t[i])?fe(t[i],r,n):t[i]=ue(r,n):t[i]=e[i]}return t}function he(t){return t[0]in c?c[t[0]]:t}function ce(t,e){var n=kt(e);if(n===H)return e.toValue();if(n===Y){if(t[0]!==v)return ce(t,e())}else if(n===B)return ue(e,!0);return e}var le=function(){function t(t){void 0===t&&(t={}),this.properties={},this.set(t)}var e=t.prototype;return e.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this.raw.apply(this,t);return ce(he(t),n)},e.raw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Vt(he(t),this.properties)},e.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=he(t),i=n.length;if(!i)return this;var r=Vt(n,this.properties,i-1);return ot(r)&&delete r[n[i-1]],this},e.set=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this,i=t.length,r=t.slice(0,-1),s=t[i-1];if(r[0]in c)n._set(c[r[0]],s);else if(2===i&&ut(r[0]))n._set(r[0],s);else if(ut(s))n._set(r,s);else if(Rt(s))qt(r)?n.set.apply(n,r.concat([function e(t,n){void 0===n&&(n={});var i=t.model;if(i){t.setOptions({model:"",suffix:"",prefix:""});var r=1<t.size()?t:t.get(0);n[i]=r}else t.forEach(function(t){e(t,n)});return n}(s)])):n._set(r,s);else if(ot(s))for(var a in s)n.set.apply(n,r.concat([a,s[a]]));else if(ft(s)){if(qt(r,!0)){if(Kt(r)||!qt(r))this._set(r,s);else{var o=ae(s);ot(o)&&n.set.apply(n,r.concat([o]))}return this}var u=function(t){for(var e=t.split(";"),n={},i=e.length,r=0;r<i;++r){var s=/([^:]*):([\S\s]*)/g.exec(e[r]);!s||s.length<3||!s[1]?--i:n[s[1].trim()]=ae(s[2].trim())}return{styles:n,length:i}}(s),f=u.styles,h=u.length;for(var a in f)n.set.apply(n,r.concat([a,f[a]]));if(h)return this;n._set(r,s)}else n._set(r,s);return n},e.has=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=he(t),i=n.length;return!!i&&!at(Vt(n,this.properties,i))},e.clone=function(){return(new t).merge(this)},e.merge=function(t){var e=this.properties,n=t.properties;return n&&fe(e,n),this},e.toCSSObject=function(){var t=this.get(),e={};for(var n in t)if(!qt([n],!0)){var i=t[n];n!==v?e[n]=i:e[v.replace("animation",rt)]=(ft(i)?i:i[M])||"initial"}var r=oe(t[k]),s=oe(t.filter);return nt&&r&&(e[nt]=r),it&&s&&(e[it]=s),e},e.toCSS=function(){var t=this.toCSSObject(),e=[];for(var n in t)e.push(n+":"+t[n]+";");return e.join("")},e._set=function(t,e){for(var n=this.properties,i=t.length,r=0;r<i-1;++r){var s=t[r];!(s in n)&&(n[s]={}),n=n[s]}i&&(n[t[i-1]]=ft(e)?ae(e):e)},t}();function ve(t,n,i,r){var s=n.length;return t.map(function(t,e){return s<=e?t:me(t,n[e],i,r)})}function pe(t,e,n,i){var r=t.type;if("color"===r)return function(t,e,n,i){var r=t.value,s=e.value,a=t.model;if(a!==e.model)return me(t.toValue(),e.toValue(),n,i);3===r.length&&(r[3]=1),3===s.length&&(s[3]=1);for(var o=ve(r,s,n,i),u=a,f=0;f<3;++f)o[f]=parseInt(o[f],10);return new zt(o,{type:"color",model:u,prefix:u+"(",suffix:")"})}(t,e,n,i);var s=ve(t.value,e.value,n,i);return new zt(s,{type:r,separator:t.separator||e.separator,prefix:t.prefix||e.prefix,suffix:t.suffix||e.suffix,model:t.model||e.model})}function me(t,e,n,i){if(0===i)return e;if(0===n||n+i===0)return t;var r=kt(t),s=kt(e),a=r===Y,o=s===Y;if(a||o)return function(){return me(a?ae(t()):t,o?ae(e()):e,n,i)};if(r!==s)return t;if(r===H)return pe(t,e,n,i);if(r===J)return ve(t,e,n,i);if("value"!==r)return t;var u,f=vt(""+t),h=vt(""+e);if(isNaN(f.value)||isNaN(h.value))return t;u=de(f.value,h.value,n,i);var c=f.prefix||h.prefix,l=f.unit||h.unit;return c||l?c+u+l:u}function de(t,e,n,i){return(t*i+e*n)/(n+i)}function ge(t){var e=[];for(var n in t)e.push(rt+"-"+mt(n)+":"+t[n]+";");return e.join("")}function ye(t){return ot(t)&&t.constructor===Object}function Se(t,e){var n=[];if(ye(t))for(var i in t)e.push(i),n=n.concat(Se(t[i],e)),e.pop();else n.push(e.slice());return n}function Ee(t,e){for(var n in e){ye(e[n])?(ot(t[n])||(t[n]={}),Ee(t[n],e[n])):t[n]=!0}return t}function we(t,e,n){var i=t[t.length-1];(!i||i[0]!==e||i[1]!==n)&&t.push([Lt(e),Lt(n)])}var xe=function(o){function m(t,e){var n=o.call(this)||this;return n.times=[],n.items={},n.names={},n.elements=[],n.needUpdate=!1,n.load(t,e),n}a(m,o);var t=m.prototype;return t.getDuration=function(){var t=this.times,e=t.length;return Math.max(this.state[b],0===e?0:t[e-1])},t.size=function(){return this.times.length},t.setDuration=function(t){if(!t)return this;var e=this.getDuration();if(0<e){var n=t/e,i=this.times,r=this.items,s={};this.times=i.map(function(t){var e=Lt(t*n);return s[e]=r[t],e}),this.items=s}return o.prototype.setDuration.call(this,Lt(t)),this},t.setId=function(t){var e=this.state;e.id=t||Bt(!!length);var n=this.elements;if(n.length&&!e[R]){var i=Qt(this.getId());e[R]="["+l+'="'+i+'"]',n.forEach(function(t){t.setAttribute(l,i)})}return this},t.set=function(n){for(var a=this,t=[],e=1;e<arguments.length;e++)t[e-1]=arguments[e];if(ut(n))for(var i=n.length,r=0;r<i;++r){var s=1===i?0:this.getUnitTime(r/(i-1)*100+"%");this.set(s,n[r])}else if(ot(n)){var o=function(t){var s=n[t],e=u.getUnitTime(t);isNaN(e)?Se(s,[t]).forEach(function(t){for(var e=Vt(t.slice(1),s),n=ut(e)?e:[Vt(t,a.target),e],i=n.length,r=0;r<i;++r)a.newFrame(r/(i-1)*100+"%").set(t,n[r])}):u.set(e,s)},u=this;for(var s in n)o(s)}else{var f=t[0];if(f instanceof le)this.setFrame(n,f);else if(f instanceof m){var h=f.getDelay(),c=this.getUnitTime(n),l=f.toObject(!this.hasFrame(c+h),c);for(var v in l)this.set(v,l[v])}else if(1===t.length&&ut(f))f.forEach(function(t){a.set(n,t)});else{var p=this.newFrame(n);p.set.apply(p,t)}}return this.needUpdate=!0,this},t.get=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this.getFrame(t);return i&&i.get.apply(i,e)},t.remove=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var i=this.getFrame(t);return i&&i.remove.apply(i,e),this.needUpdate=!0,this},t.append=function(t){return this.set(this.getDuration(),t),this},t.prepend=function(t){if(t instanceof m){var e=t.getDuration()+t.getDelay(),n=this.getFrame(0);this.removeFrame(0),this.unshift(e),this.set(0,t),this.set(e+d,n)}else this.prepend(new m(t));return this},t.unshift=function(n){var t=this.times,i=this.items,r={};this.times=t.map(function(t){var e=Lt(n+t);return r[e]=i[t],e}),this.items=r},t.toObject=function(n,i){void 0===n&&(n=!0),void 0===i&&(i=0);var r={},s=this.getDelay();return this.forEach(function(t,e){r[(e||n?0:d)+s+i+e]=t.clone()}),r},t.setSelector=function(t){this.setElement(t)},t.setElement=function(t){var s=this.state,a=[];if(!t)return this;if(!0===t||ft(t)){var e=!0===t?""+s.id:t,n=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(e);a=dt(wt(n?n[1]:e,!0)),s[R]=e}else a=t instanceof Element?[t]:dt(t);return a.length&&(this.elements=a,this.setId(this.getId()),this.target=a[0].style,this.targetFunc=function(t){var n=t.get("attribute");if(n){var e=function(e){a.forEach(function(t){t.setAttribute(e,n[e])})};for(var i in n)e(i)}var r=t.toCSS();if(s.cssText!==r)return s.cssText=r,a.forEach(function(t){t.style.cssText+=r}),t}),this},t.setTarget=function(i){return this.target=i,this.targetFunc=function(t){var e=t.get();for(var n in e)i[n]=e[n]},this},t.setCSS=function(t,e){return this.set(t,function(t,e){if(!t||!e||!e.length)return{};var n;if(t instanceof Element)n=t;else{if(!t.length)return{};n=t[0]}for(var i={},r=window.getComputedStyle(n),s=e.length,a=0;a<s;++a)i[e[a]]=r[e[a]];return i}(this.elements,e)),this},t.setTime=function(t,e,n){o.prototype.setTime.call(this,t,e);var i=this.getIterationTime(),r=this.getEasing()||n,s=this.getNowFrame(i,r),a=this.getTime();return this.temp=s,this.trigger("animate",{frame:s,currentTime:a,time:i}),this.targetFunc&&this.targetFunc(s),this},t.update=function(){var e=this.names;return this.forEach(function(t){Ee(e,t.properties)}),this.needUpdate=!1,this},t.newFrame=function(t){var e=this.getFrame(t);return e||(e=new le,this.setFrame(t,e),e)},t.setFrame=function(t,e){var n=this.getUnitTime(t);return this.items[n]=e,function(t,e){for(var n=t.length,i=0;i<n;++i)if(e<t[i])return t.splice(i,0,e);t[n]=e}(this.times,n),this.needUpdate=!0,this},t.getFrame=function(t){return this.items[this.getUnitTime(t)]},t.hasFrame=function(t){return this.getUnitTime(t)in this.items},t.hasName=function(t){return this.needUpdate&&this.update(),$t(this.names,t,!0)},t.removeFrame=function(t){var e=this.items,n=this.times.indexOf(t);return delete e[t],-1<n&&this.times.splice(n,1),this},t.mergeFrame=function(t,e){e&&this.newFrame(t).merge(e);return this},t.getNowFrame=function(n,t,i){var r=this;this.needUpdate&&this.update();var s=new le,e=function(t,e){for(var n=t.length,i=0;i<n;++i){if(t[i]===e)return[i,i];if(t[i]>e)return[0<i?i-1:0,i]}return[n-1,n-1]}(this.times,n),a=e[0],o=e[1],u=this.getEasing()||t,f=this.names;if(this.hasName([v])){var h=this._getNowValue(n,[v],a,o,!1,0,!0);ht(h)&&(u=h)}if(i){var c=Ee({},this.getFrame(n).properties);for(var l in p)l in c&&(c[l]=f[l]);f=c}return Se(f,[]).forEach(function(t){var e=r._getNowValue(n,t,a,o,i,u,Kt(t));at(e)||s.set(t,e)}),s},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),e&&this.setOptions(e),ut(t))this.set(t);else if(t.keyframes)this.set(t.keyframes);else for(var n in t)"options"!==n&&this.set(((i={})[n]=t[n],i));return e&&e[b]&&this.setDuration(e[b]),this;var i},t.clone=function(){var n=new m;return n.setOptions(this.state),this.forEach(function(t,e){n.setFrame(e,t.clone())}),n},t.forEach=function(e){var t=this.times,n=this.items;return t.forEach(function(t){e(n[t],t,n)}),this},t.setOptions=function(t){void 0===t&&(t={}),o.prototype.setOptions.call(this,t);var e=t.id,n=t.selector,i=t.elements,r=t.element,s=t.target;return e&&this.setId(e),s?this.setTarget(s):(i||r||n)&&this.setElement(i||r||n),this},t.toCSS=function(t,e,n){void 0===t&&(t={className:j}),void 0===e&&(e=this.getDuration()),void 0===n&&(n=[]);var i=this.state,r=i[R];if(!r)return"";var s=this.getDuration();i[b]=s,n.push(i);var a,o,u,f,h=dt(n).reverse(),c=Qt(Gt(this)),l=n[0],v=Xt(h,function(t){return t[O]===U||!isFinite(t[b])},n.length-1),p=h.slice(0,v),m=e||p.reduce(function(t,e){return(e[_]+t*e[O])/e[A]},s),d=h.slice(v).reduce(function(t,e){return(t+e[_])/e[A]},0),g=(a=h,o=function(t){return t[N]&&t[M]},u=i,f=Xt(a,o),-1<f?a[f]:u)[M],y=h[v][O],S=l[I],E=h[v][C],w=ge({fillMode:S,direction:E,iterationCount:y,delay:d+"s",name:F+"KEYFRAMES_"+c,duration:m/l[A]+"s",timingFunction:g}),x=ct(r).map(function(t){var e=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(t);return e?[e[0],e[1]]:[t,""]}),T=t.className,D=t.selector;return"\n    "+((ht(D)?D(this,r):D)||x.map(function(t){var e=t[0],n=t[1];return e+"."+T+n}))+" {"+w+"}\n    "+x.map(function(t){var e=t[0],n=t[1];return e+"."+P+n})+" {"+rt+"-play-state: paused;}\n    @"+st+" "+F+"KEYFRAMES_"+c+"{"+this._toKeyframes(m,p,E)+"}"},t.exportCSS=function(t,e,n){if(!this.elements.length)return"";var i=this.toCSS(t,e,n);return!(n&&!at(n[O]))&&Jt(Gt(this),i),this},t.pause=function(){return o.prototype.pause.call(this),Yt(this)&&this.pauseCSS(),this},t.pauseCSS=function(){return this.elements.forEach(function(t){xt(t,P)}),this},t.endCSS=function(){return this.elements.forEach(function(t){Tt(t,P),Tt(t,j)}),Zt(this,!1),this},t.end=function(){return Ht(this)&&this.endCSS(),o.prototype.end.call(this),this},t.playCSS=function(t,e,n){return void 0===t&&(t=!0),void 0===n&&(n={}),Wt(this,t,e,n),this},t.addPlayClass=function(t,e,n){void 0===n&&(n={});var i=this.elements,r=i.length,s=ge(n);if(r)return t?i.forEach(function(t){Tt(t,P)}):i.forEach(function(t){var e,n;t.style.cssText+=s,n=j,((e=t).classList?e.classList.contains(n):e.className.match(new RegExp("(\\s|^)"+n+"(\\s|$)")))?(Tt(t,j),yt(function(){yt(function(){xt(t,j)})})):xt(t,j)}),i[0]},t._toKeyframes=function(r,t,s){var a=this,o={},e=this.times.slice();if(!e.length)return"";var u=this.getDuration();!this.getFrame(0)&&e.unshift(0),!this.getFrame(u)&&e.push(u);var n,y,S,i=(n=t,y=e.map(function(t){return[t,t]}),S=[],n.forEach(function(t){for(var e=t[O],n=t[_],i=t[A],r=t[C],s=Math.ceil(e),a=y[y.length-1][0],o=y.length,u=a*e,f=0;f<s;++f)for(var h=r===w||r===E&&f%2||r===x&&!(f%2),c=0;c<o;++c){var l=y[h?o-c-1:c],v=l[1],p=a*f+(h?a-l[0]:l[0]),m=y[h?o-c:c-1];if(u<p){if(0!==c){var d=a*f+(h?a-m[0]:m[0]),g=de(m[1],v,u-d,p-u);we(S,(n+a*e)/i,g)}break}if(p===u&&S[S.length-1][0]===u+n)break;we(S,(n+p)/i,v)}n&&S.unshift([0,S[0][1]]),y=S,S=[]}),y),f=i[i.length-1];f[0]<r&&we(i,r,f[1]);var h=-1;return i.map(function(t){var e=t[0],n=t[1];o[n]||(o[n]=(a.hasFrame(n)&&0!==n&&n!==u?a.getNowFrame(n,0,!0):a.getNowFrame(n)).toCSS());var i=e/r*100;return i-h<d&&(i+=d),h=i,Math.min(i,100)+"%{\n                "+(0!==e||te(0,1,s)?o[n]:"")+"\n            }"}).join("")},t._getNowValue=function(t,e,n,i,r,s,a){for(var o,u,f,h,c=this.times,l=c.length,v=n;0<=v;--v){if((m=this.getFrame(c[v])).has.apply(m,e)){o=c[v],f=m;break}}var p=f&&f.raw.apply(f,e);if(r&&!qt([e[0]]))return o===t?p:void 0;if(a)return p;for(v=i;v<l;++v){var m;if((m=this.getFrame(c[v])).has.apply(m,e)){u=c[v],h=m;break}}var d=h&&h.raw.apply(h,e);return!f||at(p)?d:!h||at(d)||p===d?p:(o<0&&(o=0),function(t,e,n,i,r,s){if(t===e)return i;if(t===n)return r;if(!s)return me(i,r,t-e,n-t);var a=s((t-e)/(n-e));return me(i,r,a,1-a)}(t,o,u,p,d,s))},m}(ie),Te=function(f){function c(t,e){var n=f.call(this)||this;return n.items={},n.load(t,e),n}a(c,f);var t=c.prototype;return t.getDuration=function(){var t=this.items,e=0;for(var n in t){var i=t[n];e=Math.max(e,i.getTotalDuration()/i.getPlaySpeed())}return Math.max(e,this.state[b])},t.setDuration=function(t){var e=this.items,n=this.getDuration();if(0===t||!isFinite(n))return this;if(0===n)for(var i in e){(s=e[i]).setDuration(t)}else{var r=t/n;for(var i in e){var s;(s=e[i]).setDelay(s.getDelay()*r),s.setDuration(s.getDuration()*r)}}return f.prototype.setDuration.call(this,t),this},t.getItem=function(t,e){return null!=e?this.items[t].getItem(e):this.items[t]},t.newItem=function(t,e){if(void 0===e&&(e={}),!(t in this.items)){var n=new xe;return this.setItem(t,n),n.setOptions(e),n}},t.setItem=function(t,e){return e.setId(t),this.items[t]=e,this},t.setTime=function(t,e,n){f.prototype.setTime.call(this,t,e);var i=this.getIterationTime(),r=this.items,s=this.getEasing()||n,a={};for(var o in r){var u=r[o];u.setTime(i*u.getPlaySpeed()-u.getDelay(),e,s),a[u.getId()]=u.temp}return this.temp=a,this.trigger("animate",{frames:a,currentTime:this.getTime(),time:i}),this},t.forEach=function(t){var e=this.items;for(var n in e)t(e[n],n,e);return this},t.toCSS=function(e,t,n){void 0===t&&(t=this.getDuration()),void 0===n&&(n=[]);var i=t&&isFinite(t)?t:0,r=[],s=this.state;return s[b]=this.getDuration(),this.forEach(function(t){r.push(t.toCSS(e,i,n.concat(s)))}),r.join("")},t.exportCSS=function(t,e,n){var i=this.toCSS(t,e,n);return(!n||!n.length)&&Jt(Gt(this),i),this},t.append=function(t){t.setDelay(t.getDelay()+this.getDuration()),this.setItem(Gt(t),t)},t.pauseCSS=function(){return this.forEach(function(t){t.pauseCSS()})},t.pause=function(){return f.prototype.pause.call(this),Yt(this)&&this.pauseCSS(),this.forEach(function(t){t.pause()}),this},t.endCSS=function(){var t=this.items;for(var e in t)t[e].endCSS();Zt(this,!1)},t.end=function(){return Ht(this)&&this.endCSS(),f.prototype.end.call(this),this},t.addPlayClass=function(t,e,n){void 0===n&&(n={});var i,r=this.items;for(var s in r){var a=r[s].addPlayClass(t,e,n);!i&&(i=a)}return i},t.playCSS=function(t,e,n){return void 0===t&&(t=!0),void 0===n&&(n={}),Wt(this,t,e,n),this},t.set=function(t){return this.load(t),this},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),!t)return this;var n=e&&e[R]||this.state[R];for(var i in t)if("options"!==i){var r=t[i],s=void 0;if(r instanceof c||r instanceof xe)this.setItem(i,r),s=r;else{if(ht(r)&&n){for(var a=W?wt(i,!0):[],o=a.length,u=new c,f=0;f<o;++f){var h=Bt();u.newItem(""+f,{id:h,selector:"["+l+'="'+h+'"]',elements:a[f]}).load(r(f,a[f]))}this.setItem(i,u);continue}(s=this.newItem(i)).load(r)}n&&s.setSelector(i)}this.setOptions(e)},t.setOptions=function(t){return void 0===t&&(t={}),f.prototype.setOptions.call(this,t),t.selector&&(this.state[R]=!0),this},t.setSelector=function(t){var e=this.state,n=t||e[R];e[R]=t,this.forEach(function(t,e){t.setSelector(!!n&&e)})},t.start=function(e){f.prototype.start.call(this,e),this.forEach(function(t){t.start(e)})},c.VERSION="1.0.0-rc5",c}(ie);function De(t,e,n){for(var i=new xe({},n),r=e.length,s=0;s<r;++s)i.set(s/(r-1)*100+"%",t,e[s]);return i}var Fe={SceneItem:xe,Frame:le,Animator:ie,default:Te,OPTIONS:L,EVENTS:r,setRole:function(t,e,n){for(var i=t.length,r=p,s=o,a=0;a<i-1;++a)!r[t[a]]&&(r[t[a]]={}),r=r[t[a]],n&&(!s[t[a]]&&(s[t[a]]={}),s=s[t[a]]);n&&(s[t[i-1]]=!0),r[t[i-1]]=!!e||{}},setAlias:function(t,e){c[t]=e},bezier:Ct,steps:Ot,STEP_START:_t,STEP_END:Nt,LINEAR:At,EASE:Mt,EASE_IN:jt,EASE_OUT:Pt,EASE_IN_OUT:Ut,animate:function(t,e){return new Te(t,e).play()},animateItem:function(t,e){return new xe(t,e).play()},zoomIn:function(t){var e=t.from,n=void 0===e?0:e,i=t.to;return De([k,"scale"],[n,void 0===i?1:i],t)},zoomOut:function(t){var e=t.from,n=void 0===e?1:e,i=t.to;return De([k,"scale"],[n,void 0===i?0:i],t)},wipeIn:function(t){var e=t.from,n=void 0===e?"-100%":e,i=t.to,r=void 0===i?"0%":i,s=t.property;return De(void 0===s?"left":s,[n,r],t)},wipeOut:function(t){var e=t.from,n=void 0===e?"0%":e,i=t.to,r=void 0===i?"100%":i,s=t.property;return De(void 0===s?"left":s,[n,r],t)},transition:function(t,e,n){var i,r,s=n.from,a=n.to,o=n.duration,u=void 0===o?t.getDuration():o,f=n.time,h=void 0===f?Math.max(t.getDuration()-u,0):f;t.set(((i={})[h]=a,i[h+u]=s,i)),e.set(((r={0:s})[u]=a,r))},fadeIn:function(t){var e=t.from,n=void 0===e?0:e,i=t.to;return De("opacity",[n,void 0===i?1:i],t)},fadeOut:function(t){var e=t.from,n=void 0===e?1:e,i=t.to;return De("opacity",[n,void 0===i?0:i],t)},blink:function(t){var e=t.from,n=void 0===e?0:e,i=t.to;return De("opacity",[n,void 0===i?1:i,n],t)}};for(var be in Fe)Te[be]=Fe[be];return Te});
//# sourceMappingURL=scene.min.js.map
