/*
Copyright (c) 2018 Daybrush
license: MIT
author: Daybrush
repository: https://github.com/daybrush/scenejs.git
@version 1.0.0-beta9
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Scene=e()}(this,function(){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function o(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var d="__SCENEJS_",a="animation-timing-function",u={transform:{},filter:{},attribute:{}},h={easing:[a]},y={"animation-timing-function":!0,contents:!0},T=1e-6,f="duration",m="fillMode",E="direction",x="iterationCount",S="delay",v="easing",w="playSpeed",p="easingName",c="paused",l="ended",g="timeupdate",I="animate",O="play",b="running",D="iteration",F="rgba",k="startAnimation",C="alternate",_="reverse",A="alternate-reverse",N="normal",M="infinite",j="playState",L="function",P="property",t=[f,m,E,x,S,v,w],e=[c,l,g,I,O,D],s=["webkit","ms","moz","o"],i=function(t){var e=(document.body||document.documentElement).style,i=s.length;if(void 0!==e[t])return t;for(var r=0;r<i;++r){var n="-"+s[r]+"-"+t;if(void 0!==e[n])return n}return""},R=i("transform"),z=i("filter"),U=i("animation"),V=U.replace("animation","keyframes"),q=function(){function e(t,e){void 0===e&&(e={}),this.options={prefix:"",suffix:"",model:"",type:"",separator:","},this.setOptions(e),this.init(t)}var t=e.prototype;return t.setOptions=function(t){return Object.assign(this.options,t),this},t.getOption=function(t){return this.options[t]},t.size=function(){return this.value.length},t.get=function(t){return this.value[t]},t.set=function(t,e){return this.value[t]=e,this},t.clone=function(){return new e(this.value.map(function(t){return t instanceof e?t.clone():t}),{separator:this.options.separator,prefix:this.options.prefix,suffix:this.options.suffix,model:this.options.model,type:this.options.type})},t.toValue=function(){return this.options.prefix+this.join()+this.options.suffix},t.join=function(){return this.value.map(function(t){return t instanceof e?t.toValue():t}).join(this.options.separator)},t.forEach=function(t){return this.value.forEach(t),this},t.init=function(t){var e=typeof t;return this.value="string"===e?t.split(this.options.separator):"object"===e?t:[t],this},e}();function K(t){var e=typeof t;if("object"===e){if(B(t))return"array";if(t instanceof q)return"property"}else if("string"===e||"number"===e)return"value";return e}function $(t){return Math.round(1e6*t)/1e6}function Y(t,e,i){var r=e.length,n=t;if(0===r)return!1;for(var s=0;s<r;++s){if(!0===n)return!1;if(!(n=n[e[s]])||!i&&!0===n)return!1}return!0}function Z(t,e){return Y(u,t,e)}function H(t){return void 0===t}function J(t){return t&&"object"==typeof t}function B(t){return Array.isArray(t)}function G(t){return"string"==typeof t}function Q(t){var e=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!e)return{prefix:"",unit:"",value:NaN};var i=e[1],r=e[2];return{prefix:i,unit:e[3],value:parseFloat(r)}}var n=function(){function t(){this.events={}}var e=t.prototype;return e.on=function(e,t){var i=this,r=this.events;if(J(e)){for(var n in e)this.on(n,e[n]);return this}return e in r||(r[e]=[]),t&&(J(t)?t.forEach(function(t){return i.on(e,t)}):r[e].push(t)),this},e.off=function(t,e){if(t)if(e){var i=this.events[t];if(!i)return this;var r=i.indexOf(e);-1!==r&&i.splice(r,1)}else this.events[t]=[];else this.events={};return this},e.trigger=function(t){for(var e=this,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var n=this.events;if(!(t in n))return this;var s=n[t];if(i.length){var a=i[0];a.type=t,a.currentTarget=this,!a.target&&(a.target=this)}return s.forEach(function(t){t.apply(e,i)}),this},t}();function W(t,e,i){var r=1-i;return i*i*i+3*i*i*r*e+3*i*r*r*t}function X(i,r,n,s){var t=function(t){var e=function(t,e,i){for(var r=i,n=1;.001<Math.abs(n);){if(n=W(t,e,r)-i,Math.abs(n)<.001)return r;r-=n/2}return r}(i,n,Math.max(Math.min(1,t),0));return W(r,s,e)};return t.easingName="cubic-bezier("+i+","+r+","+n+","+s+")",t}function tt(i,r){var t=function(t){var e=1/i;return("end"===r?e:0)+Math.floor(t/e)*e};return t.easingName="steps("+i+", "+r+")",t}var et=tt(1,"start"),it=tt(1,"end"),rt=X(0,0,1,1),nt=X(.25,.1,.25,1),st=X(.42,0,1,1),at=X(0,0,.58,1),ot=X(.42,0,.58,1),ut=0;function ft(t){return t.replace(/[\s-_]([a-z])/g,function(t,e){return e.toUpperCase()})}var ht=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){var e=Date.now(),i=Math.max(0,16-(e-ut)),r=window.setTimeout(function(){t(e+i)},1e3/60);return ut=e+i,r}}();function ct(t,e,i){return i===_||("infinite"!==e&&t===e&&e%1==0?i===(1<=t%2?A:C):i===(1<=t%2?C:A))}var mt=[x,S,m,E,w,f,w,"iterationTime",j],lt=mt.concat([v,p]),vt=function(i){function t(t){var e=i.call(this)||this;return e.options={},e.state={id:"",easing:0,easingName:"linear",iterationCount:1,delay:0,fillMode:"forwards",direction:N,playSpeed:1,currentTime:0,iterationTime:-1,currentIterationCount:0,tickTime:0,prevTime:0,playState:c,duration:0},e.setOptions(t),e}o(t,i);var e,r,n,s=t.prototype;return s.setEasing=function(t){var e=Array.isArray(t)?X(t[0],t[1],t[2],t[3]):t,i=e[p]||"linear";return this.setState({easing:e,easingName:i}),this},s.setOptions=function(t){for(var e in void 0===t&&(t={}),t){var i=t[e];e!==v?e!==f?(e in this.state?this.state:this.options)[e]=i:i&&this.setDuration(i):this.setEasing(i)}return this},s.getTotalDuration=function(){return this.state[x]===M?1/0:this.state[S]+this.getActiveDuration()},s.getActiveDuration=function(){return this.state[x]===M?1/0:this.getDuration()*this.state[x]},s.isEnded=function(){return 0===this.state.tickTime&&this.state[j]===c||!(this.getTime()<this.getActiveDuration())},s.isPaused=function(){return this.state[j]===c},s.setNext=function(t){return this.on(l,function(){t.play()}),this},s.play=function(){var e=this;return this.state[j]=b,this.isEnded()&&this.setTickTime(0),this.state.tickTime=this.getTime(),ht(function(t){e.state.prevTime=t,e.tick(t)}),this.trigger(O),this},s.pause=function(){return this.state[j]=c,this.trigger(c),this},s.end=function(){return this.pause(),this.trigger(l),this},s.reset=function(){return this.state.tickTime=0,this.setTime(0),this.pause(),this},s.setTime=function(t,e){var i=this.getActiveDuration(),r=e?t:this.getUnitTime(t);return this.state.tickTime=this.state.delay+r,r<0?r=0:i<r&&(r=i),this.state.currentTime=r,this.calculateIterationTime(),this.isDelay()||this.trigger(g,{currentTime:r,time:this.getIterationTime(),iterationCount:this.getIterationCount()}),this},s.getState=function(t){return this.state[t]},s.setState=function(t){for(var e in t)this.state[e]=t[e];return this},s.getTime=function(){return this.state.currentTime},s.getUnitTime=function(t){if(G(t)){var e=this.getDuration()||100;if("from"===t)return 0;if("to"===t)return e;var i=Q(t),r=i.unit,n=i.value;return"%"===r?(!this.getDuration()&&(this.state.duration=e),parseFloat(t)/100*e):">"===r?n+T:n}return $(t)},s.isDelay=function(){var t=this.state,e=t.delay,i=t.tickTime;return 0<e&&i<e},s.setCurrentIterationCount=function(t){var e=this.state,i=Math.floor(t);return e.currentIterationCount<i&&this.trigger("iteration",{currentTime:e.currentTime,iterationCount:i}),e.currentIterationCount=t,this},s.calculateIterationTime=function(){var t=this.state,e=t.iterationCount,i=t.fillMode,r=t.direction,n=this.getDuration(),s=this.getTime(),a=0===n?0:s/n,o=n?s%n:0;if(!n)return this.setIterationTime(0),this;this.setCurrentIterationCount(a);var u=ct(a,e,r);(u&&(o=n-o),e!==M)&&(e<=a&&(o=n*("both"===i||"forwards"===i?e%1||1:0),u&&(o=n-o)));return this.setIterationTime(o),this},s.tick=function(t){var e=this,i=this.state,r=i.playSpeed,n=i.prevTime,s=this.state.tickTime+Math.min(1e3,t-n)/1e3*r;i.prevTime=t,this.setTickTime(s),this.isEnded()?this.end():i[j]!==c&&ht(function(t){e.tick(t)})},s.setTickTime=function(t){this.setTime(t-this.state.delay,!0)},t=function(t,e,i,r){var n,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;0<=o;o--)(n=t[o])&&(a=(s<3?n(a):3<s?n(e,i,a):n(e,i))||a);return 3<s&&a&&Object.defineProperty(e,i,a),a}([(e=lt,r=mt,n="state",function(t){var i=t.prototype;e.forEach(function(t){i[ft("get "+t)]=function(){return this[n][t]}}),r.forEach(function(e){i[ft("set "+e)]=function(t){return this[n][e]=t,this}})})],t)}(n),pt=["rgb",F,"hsl","hsla"];function gt(t){var e,i="#"===(e=t).charAt(0)?e.substring(1):e,r=parseInt(i.substring(0,2),16),n=parseInt(i.substring(2,4),16),s=parseInt(i.substring(4,6),16),a=parseInt(i.substring(6,8),16)/255;return isNaN(a)&&(a=1),[r,n,s,a]}function dt(t){var e=F;return 3===t.length&&(t[3]=1),new q(t,{model:e,separator:",",type:"color",prefix:e+"(",suffix:")"})}function yt(t){var e;if(t instanceof q)e=t;else if(B(t))e=dt(t);else if(G(t))return Et(t);var i=e.value,r=i.length;4===r?i[3]=parseFloat(i[3]):3===r&&(i[3]=1),e.setOptions({type:"color"});var n=e.getOption("model").toLowerCase();switch("rgb"===n&&e.setOptions({type:"color",model:F,prefix:F+"(",suffix:")"}),n){case"rgb":case F:for(var s=0;s<3;++s)i[s]=parseInt(i[s],10);break;case"hsl":case"hsla":for(s=1;s<3;++s)-1!==i[s].indexOf("%")&&(i[s]=parseFloat(i[s])/100);return dt(i=function(t){var e=t[0],i=t[1],r=t[2];e<0&&(e+=360*Math.floor((Math.abs(e)+360)/360)),e%=360;var n,s=(1-Math.abs(2*r-1))*i,a=s*(1-Math.abs(e/60%2-1)),o=r-s/2;e<60?n=[s,a,0]:e<120?n=[a,s,0]:e<180?n=[0,s,a]:e<240?n=[0,a,s]:e<300?n=[a,0,s]:e<360&&(n=[s,0,a]);var u=[Math.round(255*(n[0]+o)),Math.round(255*(n[1]+o)),Math.round(255*(n[2]+o))];return 3<t.length&&(u[3]=t[3]),u}(i))}return e}function St(t){var e=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(t);if(!e||e.length<4)return t;var i,r=e[1]||"",n=e[2],s=r+"(",a=")"+e[3],o=",",u=xt(n);u instanceof q?(o=u.getOption("separator"),i=u.value,s+=u.getOption("prefix"),a=u.getOption("suffix")+a):i=[n];var f=new q(i,{separator:o,model:r,prefix:s,suffix:a});return-1!==pt.indexOf(r)?yt(f):f}function Tt(t,e){return new q(t,{type:"array",separator:e})}function Et(t){var e,i,r,n;if("#"===t.charAt(0))return dt(4===t.length?gt((i=(e=t).charAt(1),r=e.charAt(2),n=e.charAt(3),["#",i,i,r,r,n,n].join(""))):gt(t));if(-1!==t.indexOf("("))return St(t);throw new Error("Invalid Format : Not a Color - "+t)}function xt(t){if(!G(t))return Array.isArray(t)?Tt(t,","):t;var e,i=(e=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g))?e.map(function(t){return t.trim()}):[];return 1<i.length?Tt(i.map(function(t){return xt(t)}),","):1<(i=t.match(/("[^"]*")|('[^']*')|([^\s()]*(?:\((?:[^()]*|\([^()]*\))*\))[^\s()]*)|\S+/g)||[]).length?Tt(i.map(function(t){return xt(t)})," "):(i=/^(['"])([^'"]*)(['"])$/g.exec(t))&&i[1]===i[3]?new q([xt(i[2])],{prefix:i[1],suffix:i[1]}):-1!==t.indexOf("(")?St(t):"#"===t.charAt(0)?Et(t):t}function wt(t){if(!t)return"";var e=[];for(var i in t)e.push(i.replace(/\d/g,"")+"("+t[i]+")");return e.join(" ")}function It(t){return t instanceof q}function Ot(t,e){return void 0===e&&(e=!1),bt({},t,e)}function bt(t,e,i){for(var r in void 0===i&&(i=!1),e){var n=e[r],s=K(n);s===P?t[r]=i?n.toValue():n.clone():s===L?t[r]=i?Dt([r],n()):n:"array"===s?t[r]=n.slice():"object"===s?J(t[r])&&!It(t[r])?bt(t[r],n,i):t[r]=Ot(n,i):t[r]=e[r]}return t}function Dt(t,e){var i=K(e);if(i===P)return e.toValue();if(i===L){if(t[0]!==a)return Dt(t,e())}else if("object"===i)return Ot(e,!0);return e}var Ft=function(){function f(t){void 0===t&&(t={}),this.properties={},this.set(t)}var t=f.prototype;return t.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.raw.apply(this,t);return Dt(t[0]in h?h[t[0]]:t,i)},t.raw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.properties,r=(t[0]in h?h[t[0]]:t),n=r.length,s=0;s<n;++s){if(!J(i))return;i=i[r[s]]}return i},t.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.properties,r=t[0]in h?h[t[0]]:t,n=r.length;if(!n)return this;for(var s=0;s<n-1;++s){if(!J(i))return this;i=i[r[s]]}return delete i[r[n-1]],this},t.set=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=t.length,n=t.slice(0,-1),s=t[r-1];if(n[0]in h)this._set(h[n[0]],s);else if(2===r&&B(n[0]))this._set(n[0],s);else if(J(s))if(B(s))this._set(n,s);else if(It(s))Z(n)?this.set.apply(this,n.concat([function e(t,i){void 0===i&&(i={});var r=t.getOption("model");if(r){t.setOptions({model:"",suffix:"",prefix:""});var n=1<t.size()?t:t.get(0);i[r]=n}else t.forEach(function(t){return e(t,i)});return i}(s)])):this._set(n,s);else if(s instanceof f)this.merge(s);else for(var a in s)this.set.apply(this,n.concat([a,s[a]]));else if(G(s)){if(Z(n)){var o=xt(s);return J(o)&&this.set.apply(this,n.concat([o])),this}var u=function(t){for(var e,i=t.split(";"),r=i.length,n=[],s=0;s<r;++s){var a=/([^:]*):([\S\s]*)/g.exec(i[s]);!a||a.length<3||!a[1]||n.push(((e={})[a[1].trim()]=xt(a[2].trim()),e))}return n}(s);if(u.forEach(function(t){e.set.apply(e,n.concat([t]))}),u.length)return this;this._set(n,s)}else this._set(n,s);return this},t.has=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.properties,r=t[0]in h?h[t[0]]:t,n=r.length;if(!n)return!1;for(var s=0;s<n;++s){if(!(J(i)&&r[s]in i))return!1;i=i[r[s]]}return!0},t.clone=function(){var t=new f;return t.merge(this),t},t.merge=function(t){var e=this.properties,i=t.properties;return i&&bt(e,i),this},t.toObject=function(){return Ot(this.properties,!0)},t.toCSSObject=function(){var t=this.toObject(),e={};for(var i in t)if(!Z([i],!0)){var r=t[i];i!==a?e[i]=r:e[a.replace("animation",U)]=(G(r)?r:r.easingName)||"initial"}var n=wt(t.transform),s=wt(t.filter);return R&&n&&(e[R]=n),z&&s&&(e[z]=s),e},t.toCSS=function(){var t=this.toCSSObject(),e=[];for(var i in t)e.push(i+":"+t[i]+";");return e.join("")},t._set=function(t,e){for(var i=this.properties,r=t.length,n=0;n<r-1;++n){var s=t[n];!(s in i)&&(i[s]={}),i=i[s]}r&&(i[t[r-1]]=G(e)?xt(e):e)},f}();var kt=function(){function t(){this.times=[],this.items={},this.names={}}var e=t.prototype;return e.getNames=function(){return function t(e,i){var r=[];for(var n in e)i.push(n),J(e[n])?r=r.concat(t(e[n],i)):r.push(i.slice()),i.pop();return r}(this.names,[])},e.hasName=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Y(this.names,t,!0)},e.update=function(){var t=this.items;for(var e in t)this.updateFrame(t[e]);return this},e.forEach=function(e){var t=this.times,i=this.items;t.forEach(function(t){e(i[t],t,i)})},e.updateFrame=function(t){if(!t)return this;var e=t.properties;return function t(e,i){for(var r in i){var n=i[r];!J(n)||B(n)||n instanceof q?e[r]=!0:(J(e[r])||(e[r]={}),t(e[r],i[r]))}}(this.names,e),this},e.getDuration=function(){var t=this.times;return 0===t.length?0:t[t.length-1]},e.setDuration=function(t,e){void 0===e&&(e=this.getDuration());var i=t/e,r=this.times,n=this.items,s={};this.times=r.map(function(t){var e=$(t*i);return s[e]=n[t],e}),this.items=s},e.unshift=function(i){var t=this.times,r=this.items,n={};return this.times=t.map(function(t){var e=$(i+t);return n[e]=r[t],e}),this.items=n,this},e.size=function(){return this.times.length},e.add=function(t,e){return this.items[t]=e,this.addTime(t),this},e.has=function(t){return t in this.items},e.get=function(t){return this.items[t]},e.remove=function(t){return delete this.items[t],this.removeTime(t),this},e.addTime=function(t){for(var e=this.times,i=e.length,r=i,n=0;n<i;++n){if(t===e[n])return this;if(t<e[n]){r=n;break}}return this.times.splice(r,0,t),this},e.removeTime=function(t){var e=this.times.indexOf(t);return-1<e&&this.times.splice(e,1),this},t}();function Ct(t,i,r,n){if(0===n)return i;if(!B(i))return t;var s=i.length;return t.map(function(t,e){return s<=e?t:At(t,i[e],r,n)})}function _t(t,e,i,r){var n=t.getOption("type");if("color"===n)return function(t,e,i,r){if(0===r)return e;var n=t.value,s=e.value,a=t.getOption("model");if(a!==e.getOption("model"))return At(t.toValue(),e.toValue(),i,r);3===n.length&&(n[3]=1),3===s.length&&(s[3]=1);for(var o=Ct(n,s,i,r),u=a,f=0;f<3;++f)o[f]=parseInt(o[f],10);return new q(o,{type:"color",model:u,prefix:u+"(",suffix:")"})}(t,e,i,r);var s=Ct(t.value,e.value,i,r);return new q(s,{type:n,separator:t.getOption("separator")||e.getOption("separator"),prefix:t.getOption("prefix")||e.getOption("prefix"),suffix:t.getOption("suffix")||e.getOption("suffix"),model:t.getOption("model")||e.getOption("model")})}function At(t,e,i,r){if(0===r)return e;if(0===i||i+r===0)return t;var n=K(t),s=K(e),a=n===L,o=s===L;if(a||o)return function(){return At(a?xt(t()):t,o?xt(e()):e,i,r)};if(n!==s)return t;if(n===P)return _t(t,e,i,r);if("array"===n)return Ct(t,e,i,r);if("value"!==n)return t;var u,f=i/(i+r),h=1-f,c=Q(""+t),m=Q(""+e);if(isNaN(c.value)||isNaN(m.value))return t;u=c.value*h+m.value*f;var l=c.prefix||m.prefix,v=c.unit||m.unit;return l||v?l+u+v:u}function Nt(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function Mt(t,e){if(t.classList)t.classList.remove(e);else{var i=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ")}}function jt(t){return t.match(/[0-9a-zA-Z]+/g).join("")}function Lt(t){var e=[];for(var i in t)e.push(U+"-"+i.replace(/([a-z])([A-Z])/g,function(t,e,i){return e+"-"+i.toLowerCase()})+" : "+t[i]+";");return e.join("")}var Pt=function(s){function l(t,e){var i=s.call(this)||this;return i.keyframes=new kt,i.elements=[],i.load(t,e),i}o(l,s);var t=l.prototype;return t.getDuration=function(){return Math.max(this.state[f],this.keyframes.getDuration())},t.setDuration=function(t){if(0===t)return this;var e=this.getDuration();return 0<e&&this.keyframes.setDuration(t,e),s.prototype.setDuration.call(this,$(t)),this},t.setId=function(t){var e=this.elements,i=e.length;this.setState({id:t||function(t){for(;;){var e=""+Math.floor(1e5*Math.random());if(!t)return e;if(!document.querySelector('[data-scene-id="'+e+'"]'))return e}}(!!i)});var r=jt(this.getId());if(this.options.selector||(this.options.selector='[data-scene-id="'+r+'"]'),!i)return this;for(var n=0;n<i;++n)e[n].setAttribute("data-scene-id",r);return this},t.getId=function(){return this.state.id},t.set=function(e){for(var i=this,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(J(e))return this.load(e),this;if(t[0]){if(t[0]instanceof l){var n=t[0],s=n.getDelay(),a=this.getUnitTime(e)+s,o=n.getAllTimes(!!s||!this.hasFrame(e)),u=o.keys,f=o.values,h=o.frames,c=this.getEasingName()!==n.getEasingName()?n.getEasing():0;return u.forEach(function(t){i.set(a+t,h[f[t]])}),c&&(this.set(a+u[0],v,c),this.set(a+u[u.length-1],v,"initial")),this}if(1===t.length&&B(t[0]))return t[0].forEach(function(t){i.set(e,t)}),this}var m=this.newFrame(e);return m.set.apply(m,t),this.updateFrame(m),this},t.get=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this.getFrame(t);return r&&r.get.apply(r,e)},t.remove=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this.getFrame(t);return r&&r.remove.apply(r,e),this.update(),this},t.append=function(t){return this.set(this.getDuration(),t),this},t.prepend=function(t){if(t instanceof l){var e=t.getDelay(),i=(t.getIterationCount()===M?t.getDuration():t.getActiveDuration())+e,r=this.keyframes.get(0);r&&this.keyframes.remove(0),this.keyframes.unshift(i),this.set(0,t),this.set(i+T,r)}else this.prepend(new l(t));return this},t.setSelector=function(t){return this.options.selector=!0===t?this.state.id:t||'[data-scene-id="'+this.state.id+'"]',this.setElement(document.querySelectorAll(this.options.selector)),this},t.setElement=function(t){return t&&(this.elements=t instanceof Element?[t]:t,this.setId(this.getId())),this},t.setCSS=function(t,e){return this.set(t,function(t,e){if(!t||!e||!e.length)return{};var i;if(t instanceof Element)i=t;else{if(!t.length)return{};i=t[0]}for(var r={},n=window.getComputedStyle(i),s=e.length,a=0;a<s;++a)r[e[a]]=n[e[a]];return r}(this.elements,e)),this},t.animate=function(t,e){return s.prototype.setTime.call(this,t,!0),this._animate(e)},t.setTime=function(t,e,i){return s.prototype.setTime.call(this,t,e),this._animate(i),this},t.update=function(){return this.keyframes.update(),this},t.updateFrame=function(t){return this.keyframes.updateFrame(t),this},t.newFrame=function(t){var e=this.getFrame(t);return e||(e=new Ft,this.setFrame(t,e),e)},t.setFrame=function(t,e){return this.keyframes.add(this.getUnitTime(t),e),this.keyframes.update(),this},t.getFrame=function(t){return this.keyframes.get(this.getUnitTime(t))},t.hasFrame=function(t){return this.keyframes.has(this.getUnitTime(t))},t.removeFrame=function(t){var e=this.keyframes;return e.remove(t),e.update(),this},t.copyFrame=function(t,e){if(J(t)){for(var i in t)this.copyFrame(i,t[i]);return this}var r=this.getFrame(t);if(!r)return this;var n=r.clone();return this.setFrame(e,n),this},t.mergeFrame=function(t,e){if(J(t)){for(var i in t)this.mergeFrame(i,t[i]);return this}var r=this.getFrame(t);return r&&this.newFrame(e).merge(r),this},t.getNowFrame=function(i,t){var r=this,n=new Ft,e=this.keyframes.getNames(),s=this._getNearTimeIndex(i),a=s.left,o=s.right,u=this._getEasing(i,a,o,this.getEasing()||t);return e.forEach(function(t){var e=r._getNowValue(i,a,o,t,u);H(e)||n.set(t,e)}),n},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),B(t))for(var i=t.length,r=0;r<i;++r){var n=1===i?0:this.getUnitTime(r/(i-1)*100+"%");this.set(n,t[r])}else if(t.keyframes)this.set(t.keyframes);else for(var n in t)if("options"!==n&&"keyframes"!==n){var s=t[n],a=this.getUnitTime(n);"number"!=typeof s?this.set(a,s):this.mergeFrame(s,a)}return e&&this.setOptions(e),this},t.clone=function(t){void 0===t&&(t={});var i=new l;return i.setOptions(this.state),i.setOptions(t),this.keyframes.forEach(function(t,e){return i.setFrame(e,t.clone())}),i},t.setOptions=function(t){void 0===t&&(t={}),s.prototype.setOptions.call(this,t);var e=t.id,i=t.selector,r=t.duration,n=t.elements;return r&&this.setDuration(r),e&&this.setId(e),n?this.setElement(n):i&&this.setSelector(!0===i?this.state.id:i),this},t.getAllTimes=function(t,e){void 0===t&&(t=!0),void 0===e&&(e={});var i=this.keyframes.times.slice(),r=i.length,n=[],s={};if(!r)return{keys:[],values:{},frames:{}};var a={},o=this.getDuration(),u=e[E]||this.state[E],f=u===C||u===A;!this.getFrame(0)&&i.unshift(0),!this.getFrame(o)&&i.push(o),r=i.length;for(var h=e[x]||this.state[x],c=(h=h!==M?h:1)*o,m=0;m<h;++m)for(var l=ct(m,h,u),v=m*o,p=0;p<r;++p)if(!f||0===m||0!==p){var g=0!==p||(0===m?t:f)?0:T,d=$(l?i[r-1-p]:i[p]),y=$(v+$(l?o-d:d)+g);if(c<y)break;if(n.push(y),!a[s[y]=d]){var S=this.getFrame(d);!S||0===p||p===r-1||S.has("transform")||S.has("filter")?a[d]=this.getNowFrame(d):a[d]=S}}if(n[n.length-1]<c){d=$(o*((l=ct(h,h,u))?1-h%1:h%1));n.push(c),!a[s[c]=d]&&(a[d]=this.getNowFrame(d))}return{keys:n,values:s,frames:a}},t.toCSS=function(t,e){void 0===t&&(t=this.getDuration()),void 0===e&&(e={});var i=this.state,r=i.selector||this.options.selector;if(!r)return"";var n=this._getId(),s=!H(e[x]),a=0===t,o=e[w]||1,u=((s?e[S]:i[S])||0)/o,f=i[v]&&i[p]||s&&e[v]&&e[p]||i[p],h=!a&&e[x]||i[x],c=Lt({fillMode:"forwards"!==e[m]&&e[m]||i[m],direction:e[E]!==N&&e[E]||i[E],iterationCount:h,delay:u+"s",name:d+"KEYFRAMES_"+jt(n),duration:t/o+"s",timingFunction:f});return r+"."+k+" {\n\t\t\t"+c+"\n\t\t}\n\t\t"+this._toKeyframes(t,s)},t.exportCSS=function(t,e){if(void 0===t&&(t=this.getDuration()),void 0===e&&(e={}),this.elements.length){var i=this._getId(),r=document.querySelector("#"+d+i),n=this.toCSS(t,e);r?r.innerText=n:document.body.insertAdjacentHTML("beforeend",'<style id="'+d+"STYLE_"+i+'">'+n+"</style>")}},t.playCSS=function(t,e){var r=this;if(void 0===t&&(t=!0),void 0===e&&(e={}),!U||this.getPlayState()===b)return this;var i=this.elements,n=i.length;if(!n)return this;this.isEnded()&&this.setTime(0),t&&this.exportCSS();for(var s,a,o=Lt(e),u=0;u<n;++u){var f=i[u];f.style.cssText+=o,a=k,((s=f).classList?s.classList.contains(a):s.className.match(new RegExp("(\\s|^)"+a+"(\\s|$)")))?(Mt(f,k),function(t){requestAnimationFrame(function(){requestAnimationFrame(function(){Nt(t,k)})})}(f)):Nt(f,k)}this.setState({playCSS:!0}),this.setPlayState(b),this.trigger(O);var h=this.getDuration(),c=i[0],m=function(){r.end(),c&&(c.removeEventListener("animationend",m),c.removeEventListener("animationiteration",l))},l=function(t){var e=t.elapsedTime,i=e/h;r.state.currentTime=e,r.setCurrentIterationCount(i)};return c.addEventListener("animationend",m),c.addEventListener("animationiteration",l),this},t._getId=function(){return this.state.id||this.setId().getId()},t._getEasing=function(t,e,i,r){if(this.keyframes.hasName(a)){var n=this._getNowValue(t,e,i,[a],0,!0);return"function"==typeof n?n:r}return r},t._toKeyframes=function(e,t){void 0===e&&(e=this.getDuration());var i=this._getId(),r=this.state,n=r[w],s=r[x],a=t?r[S]:0,o=t?r[E]:N,u=this.getAllTimes(!0,{duration:e,delay:a,direction:o,iterationCount:t&&s!==M?s:1,isCSS:!0}),f=u.keys,h=u.values,c=u.frames,m=f.length,l={},v=[];for(var p in c)l[p]=c[p].toCSS();if(!f.length)return"";a&&(v.push("0%{"+c[0]+"}"),o!==_&&o!==A||v.push(a/n/e*100-1e-5+"%{"+l[0]+"}")),f.forEach(function(t){v.push((a+t)/n/e*100+"%{"+l[h[t]]+"}")});var g=f[m-1];return(a+g)/n<e&&v.push("100%{"+l[h[g]]),"@"+V+" "+d+"KEYFRAMES_"+jt(i)+"{\n\t\t\t"+v.join("\n")+"\n\t\t}"},t._getNowValue=function(t,e,i,r,n,s){void 0===n&&(n=this.getEasing()),void 0===s&&(s=Y(y,r,!0));for(var a,o,u,f,h=this.keyframes,c=h.times,m=c.length,l=e;0<=l;--l){if((p=h.get(c[l])).has.apply(p,r)){a=c[l],u=p;break}}var v=u&&u.raw.apply(u,r);if(s)return v;for(l=i;l<m;++l){var p;if((p=h.get(c[l])).has.apply(p,r)){o=c[l],f=p;break}}var g=f&&f.raw.apply(f,r);return!u||H(v)?g:!f||H(g)||v===g?v:(a<0&&(a=0),function(t,e,i,r,n,s){if(t===e)return r;if(t===i)return n;if(!s)return At(r,n,t-e,i-t);var a=s((t-e)/(i-e));return At(r,n,a,1-a)}(t,a,o,v,g,n))},t._getNearTimeIndex=function(t){for(var e=this.keyframes.times,i=e.length,r=0;r<i;++r){if(e[r]===t)return{left:r,right:r};if(e[r]>t)return{left:0===r?0:r-1,right:r}}return{left:i-1,right:i-1}},t._animate=function(t){var e=this.getIterationTime(),i=this.getEasing()||t,r=this.getNowFrame(e,i),n=this.getTime();this.trigger("animate",{frame:r,currentTime:n,time:e});var s=this.elements,a=s.length;if(!a)return r;var o=r.get("attribute");if(o)for(var u in o)for(var f=0;f<a;++f)s[f].setAttribute(u,o[u]);var h=r.toCSS();if(this.state.cssText!==h){this.state.cssText=h;for(f=0;f<a;++f)s[f].style.cssText+=h;return r}},l}(vt),Rt=function(r){function a(t,e){var i=r.call(this)||this;return i.items={},i.load(t,e),i}o(a,r);var t=a.prototype;return t.setId=function(t){return void 0===t&&(t="scene"+Math.floor(1e5*Math.random())),this.state.id=t,this},t.getId=function(){return this.state.id},t.getDuration=function(){var t=this.items,e=0;for(var i in t){var r=t[i];e=Math.max(e,r.getTotalDuration()/r.getPlaySpeed())}return e},t.setDuration=function(t){var e=this.items,i=this.getDuration();if(0===t||!isFinite(i))return this;if(0===i)for(var r in e){(s=e[r]).setDuration(t)}else{var n=t/i;for(var r in e){var s;(s=e[r]).setDelay(s.getDelay()*n),s.setDuration(s.getDuration()*n)}}return this},t.getItem=function(t){return this.items[t]},t.newItem=function(t,e){if(void 0===e&&(e={}),t in this.items)return this.items[t];var i=new Pt;return this.setItem(t,i),i.setOptions(e),i},t.setItem=function(t,e){return e instanceof vt&&e.setId(t),this.items[t]=e,this},t.animate=function(t,e){return r.prototype.setTime.call(this,t,!0),this._animate(e)},t.setTime=function(t,e,i){return r.prototype.setTime.call(this,t,e),this._animate(i),this},t.forEach=function(t){var e=this.items;for(var i in e)t(e[i],i,e);return this},t.exportCSS=function(t,e){void 0===t&&(t=this.getDuration());var i=this.items,r=t;for(var n in r&&isFinite(r)||(r=0),i){i[n].exportCSS(r,this.state)}return this},t.append=function(t){t.setDelay(t.getDelay()+this.getDuration()),this.setItem(t.getId()||t.setId().getId(),t)},t.playCSS=function(t,e){var r=this;if(void 0===t&&(t=!0),void 0===e&&(e={}),!U||this.getPlayState()===b)return this;t&&this.exportCSS();var i,n=this.items;for(var s in n){var a=n[s];a.playCSS(!1,e),a.getState("playCSS")&&(i=a)}if(!i)return this;var o=function(t){var e=t.currentTime,i=t.iterationCount;r.state.currentTime=e,r.setCurrentIterationCount(i)},u=function(){r.end(),r.setState({playCSS:!1}),i.off(l,u),i.off(D,o)};return i.on(l,u),i.on(D,o),this.setState({playCSS:!0}),this.setPlayState(b),this.trigger(O),this},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),!t)return this;var i=e&&e.selector;for(var r in t)if("options"!==r){var n=t[r],s=void 0;n instanceof a||n instanceof Pt?(this.setItem(r,n),s=n):(s=this.newItem(r)).load(n),i&&s.setSelector(r)}this.setOptions(e)},t.setSelector=function(t){var i=this.options.selector;this.forEach(function(t,e){t.setSelector(!!i&&e)})},t._animate=function(t){var e=this.getIterationTime(),i=this.items,r=this.getEasing()||t,n={};for(var s in i){var a=i[s];n[s]=a.animate(Math.max(e*a.getPlaySpeed()-a.getDelay(),0),r)}return this.trigger(I,{currentTime:this.getTime(),time:e,frames:n}),n},a}(vt);function zt(t,e,i){for(var r=new Pt({},i),n=e.length,s=0;s<n;++s)r.set(s/(n-1)*100+"%",t,e[s]);return r}var Ut={VERSION:"1.0.0-beta9",SceneItem:Pt,Frame:Ft,Animator:vt,Keyframes:kt,PropertyObject:q,default:Rt,bezier:X,EASE_IN_OUT:ot,EASE_IN:st,EASE_OUT:at,EASE:nt,LINEAR:rt,steps:tt,STEP_START:et,STEP_END:it,set:zt,transition:function(t,e,i){var r,n,s=i.from,a=i.to,o=i.duration,u=void 0===o?t.getDuration():o,f=i.time,h=void 0===f?Math.max(t.getDuration()-u,0):f;t.set(((r={})[h]=s,r[h+u]=a,r)),e.set(((n={0:a})[u]=s,n))},wipeIn:function(t){var e=t.from,i=void 0===e?"-100%":e,r=t.to,n=void 0===r?"0%":r,s=t.property;return zt(void 0===s?"left":s,[i,n],t)},wipeOut:function(t){var e=t.from,i=void 0===e?"0%":e,r=t.to,n=void 0===r?"100%":r,s=t.property;return zt(void 0===s?"left":s,[i,n],t)},fadeIn:function(t){var e=t.from,i=void 0===e?0:e,r=t.to;return zt("opacity",[i,void 0===r?1:r],t)},fadeOut:function(t){var e=t.from,i=void 0===e?1:e,r=t.to;return zt("opacity",[i,void 0===r?0:r],t)},blink:function(t){var e=t.from,i=void 0===e?0:e,r=t.to;return zt("opacity",[i,void 0===r?1:r,i],t)},zoomIn:function(t){var e=t.from,i=void 0===e?0:e,r=t.to;return zt(["transform","scale"],[i,void 0===r?1:r],t)},zoomOut:function(t){var e=t.from,i=void 0===e?1:e,r=t.to;return zt(["transform","scale"],[i,void 0===r?0:r],t)},OPTIONS:t,EVENTS:e,setRole:function(t,e,i){for(var r=t.length,n=u,s=y,a=0;a<r-1;++a)!n[t[a]]&&(n[t[a]]={}),n=n[t[a]],i&&(!s[t[a]]&&(s[t[a]]={}),s=s[t[a]]);i&&(s[t[r-1]]=!0),n[t[r-1]]=!!e||{}},setAlias:function(t,e){h[t]=e}};for(var Vt in Ut)Rt[Vt]=Ut[Vt];return Rt});
//# sourceMappingURL=scene.min.js.map
