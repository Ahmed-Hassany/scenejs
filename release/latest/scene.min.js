/*
Copyright (c) 2018 Daybrush
license: MIT
author: Daybrush
repository: https://github.com/daybrush/scenejs.git
@version 1.0.0-beta12
*/
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Scene=e()}(this,function(){"use strict";var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])})(t,e)};function o(t,e){function i(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}var n=function(){return(n=Object.assign||function(t){for(var e,i=1,r=arguments.length;i<r;i++)for(var n in e=arguments[i])Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t}).apply(this,arguments)};var E="__SCENEJS_",a="animation-timing-function",u={transform:{},filter:{},attribute:{}},h={easing:[a]},g={"animation-timing-function":!0,contents:!0},C=1e-6,f="duration",x="fillMode",I="direction",w="iterationCount",O="delay",m="easing",b="playSpeed",p="easingName",c="paused",l="ended",v="timeupdate",d="animate",y="play",S="running",T="startAnimation",D="pauseAnimation",F="alternate",k="reverse",_="alternate-reverse",A="normal",N="infinite",M="playState",j="function",P="property",t=[f,x,I,w,O,m,b],e=[c,l,v,d,y,"iteration"],s=["webkit","ms","moz","o"],i=function(t){var e=(document.body||document.documentElement).style,i=s.length;if(void 0!==e[t])return t;for(var r=0;r<i;++r){var n="-"+s[r]+"-"+t;if(void 0!==e[n])return n}return""},L="rgb",z="rgba",R="hsl",U="hsla",V=i("transform"),q=i("filter"),K=i("animation"),$=K.replace("animation","keyframes");function Y(t){return void 0===t}function Z(t){return t&&"object"==typeof t}function H(t){return Array.isArray(t)}function J(t){return"string"==typeof t}function B(t){var e=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g);return e?e.map(function(t){return t.trim()}):[]}function G(t){var e=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(t);return!e||e.length<4?{}:{prefix:e[1],value:e[2],suffix:e[3]}}function Q(t){var e=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!e)return{prefix:"",unit:"",value:NaN};var i=e[1],r=e[2];return{prefix:i,unit:e[3],value:parseFloat(r)}}function W(t){return t.replace(/[\s-_]([a-z])/g,function(t,e){return e.toUpperCase()})}var X=[L,z,R,U];function tt(t){var e,i="#"===(e=t).charAt(0)?e.substring(1):e,r=parseInt(i.substring(0,2),16),n=parseInt(i.substring(2,4),16),s=parseInt(i.substring(4,6),16),a=parseInt(i.substring(6,8),16)/255;return isNaN(a)&&(a=1),[r,n,s,a]}function et(t){if("#"===t.charAt(0))return 4===t.length?tt((f=(u=t).charAt(1),h=u.charAt(2),c=u.charAt(3),["#",f,f,h,h,c,c].join(""))):tt(t);if(-1!==t.indexOf("(")){var e=G(t),i=e.prefix,r=e.value;if(!i||!r)return;var n=B(r),s=[],a=n.length;switch(i){case L:case z:for(var o=0;o<a;++o)s[o]=parseFloat(n[o]);return s;case R:case U:for(o=0;o<a;++o)-1!==n[o].indexOf("%")?s[o]=parseFloat(n[o])/100:s[o]=parseFloat(n[o]);return function(t){var e=t[0],i=t[1],r=t[2];e<0&&(e+=360*Math.floor((Math.abs(e)+360)/360)),e%=360;var n,s=(1-Math.abs(2*r-1))*i,a=s*(1-Math.abs(e/60%2-1)),o=r-s/2;return e<60?n=[s,a,0]:e<120?n=[a,s,0]:e<180?n=[0,s,a]:e<240?n=[0,a,s]:e<300?n=[a,0,s]:e<360&&(n=[s,0,a]),[Math.round(255*(n[0]+o)),Math.round(255*(n[1]+o)),Math.round(255*(n[2]+o)),3<t.length?t[3]:1]}(s)}}var u,f,h,c}function it(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function rt(t,e){if(t.classList)t.classList.remove(e);else{var i=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(i," ")}}var nt=function(){function t(){this.events={}}var e=t.prototype;return e.on=function(e,t){var i=this,r=this.events;if(Z(e)){for(var n in e)this.on(n,e[n]);return this}return e in r||(r[e]=[]),t&&(Z(t)?t.forEach(function(t){return i.on(e,t)}):r[e].push(t)),this},e.off=function(t,e){if(t)if(e){var i=this.events[t];if(!i)return this;var r=i.indexOf(e);-1!==r&&i.splice(r,1)}else this.events[t]=[];else this.events={};return this},e.trigger=function(t){for(var e=this,i=[],r=1;r<arguments.length;r++)i[r-1]=arguments[r];var n=this.events;if(!(t in n))return this;var s=n[t];if(i.length){var a=i[0];a.type=t,a.currentTarget=this,!a.target&&(a.target=this)}return s.forEach(function(t){t.apply(e,i)}),this},t}();function st(t,e,i){var r=1-i;return i*i*i+3*i*i*r*e+3*i*r*r*t}function at(i,r,n,s){var t=function(t){var e=function(t,e,i){for(var r=i,n=1;.001<Math.abs(n);){if(n=st(t,e,r)-i,Math.abs(n)<.001)return r;r-=n/2}return r}(i,n,Math.max(Math.min(1,t),0));return st(r,s,e)};return t.easingName="cubic-bezier("+i+","+r+","+n+","+s+")",t}function ot(i,r){var t=function(t){var e=1/i;return 1<=t?1:("start"===r?e:0)+Math.floor(t/e)*e};return t.easingName="steps("+i+", "+r+")",t}var ut=ot(1,"start"),ft=ot(1,"end"),ht=at(0,0,1,1),ct=at(.25,.1,.25,1),lt=at(.42,0,1,1),vt=at(0,0,.58,1),mt=at(.42,0,.58,1),pt=function(){function e(t,e){this.options={prefix:"",suffix:"",model:"",type:"",separator:","},e&&this.setOptions(e),this.init(t)}var t=e.prototype;return t.setOptions=function(t){var e=this.options;for(var i in t)e[i]=t[i];return e&&(this.options=n({},this.options,e)),this},t.getOption=function(t){return this.options[t]},t.size=function(){return this.value.length},t.get=function(t){return this.value[t]},t.set=function(t,e){return this.value[t]=e,this},t.clone=function(){return new e(this.value.map(function(t){return t instanceof e?t.clone():t}),this.options)},t.toValue=function(){return this.options.prefix+this.join()+this.options.suffix},t.join=function(){return this.value.map(function(t){return t instanceof e?t.toValue():t}).join(this.options.separator)},t.forEach=function(t){return this.value.forEach(t),this},t.init=function(t){var e=typeof t;return this.value="string"===e?t.split(this.options.separator):"object"===e?t:[t],this},e}();function dt(t){var e=typeof t;if("object"===e){if(H(t))return"array";if(t instanceof pt)return"property"}else if("string"===e||"number"===e)return"value";return e}function gt(t){return Math.round(1e6*t)/1e6}function yt(t,e,i){var r=e.length,n=t;if(0===r)return!1;for(var s=0;s<r;++s){if(!0===n)return!1;if(!(n=n[e[s]])||!i&&!0===n)return!1}return!0}function St(t,e){return yt(u,t,e)}function Tt(t,e){var i=E+"STYLE_"+Et(t),r=document.querySelector("#"+i);r?r.innerText=e:document.body.insertAdjacentHTML("beforeend",'<style id="'+i+'">'+e+"</style>")}function Et(t){return t.match(/[0-9a-zA-Z]+/g).join("")}function Ct(t,e,i){if(void 0===i&&(i={}),K&&t.getPlayState()!==S){if((n=t).state.playCSS&&n.getPlayState()===c)t.addPlayClass(!0,i);else{t.isEnded()&&t.setTime(0),e&&t.exportCSS();var r=t.addPlayClass(!1,i);if(!r)return;!t.state.peusdo&&function(n,t){var s=n.getDuration(),a=!s||!isFinite(s),e=function(){a||(n.setState({playCSS:!1}),n.finish())};n.on(l,function(){t.removeEventListener("animationend",e),t.removeEventListener("animationiteration",i)});var i=function(t){var e=t.elapsedTime,i=e,r=a?0:i/s;n.state.currentTime=i,n.setCurrentIterationCount(r)};t.addEventListener("animationend",e),t.addEventListener("animationiteration",i)}(t,r),t.setState({playCSS:!0})}var n;t.setPlayState(S),t.trigger(y)}}var xt=0;var It=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){var e=Date.now(),i=Math.max(0,16-(e-xt)),r=window.setTimeout(function(){t(e+i)},1e3/60);return xt=e+i,r}}();function wt(t,e,i){return i===k||("infinite"!==e&&t===e&&e%1==0?i===(1<=t%2?_:F):i===(1<=t%2?F:_))}var Ot=[w,O,x,I,b,f,b,"iterationTime",M],bt=Ot.concat([m,p]),Dt=function(i){function t(t){var e=i.call(this)||this;return e.options={},e.state={id:"",easing:0,easingName:"linear",iterationCount:1,delay:0,fillMode:"forwards",direction:A,playSpeed:1,currentTime:0,iterationTime:-1,currentIterationCount:0,tickTime:0,prevTime:0,playState:c,duration:0},e.setOptions(t),e}o(t,i);var e,r,n,s=t.prototype;return s.setEasing=function(t){var e=Array.isArray(t)?at(t[0],t[1],t[2],t[3]):t,i=e[p]||"linear";return this.setState({easing:e,easingName:i}),this},s.setOptions=function(t){for(var e in void 0===t&&(t={}),t){var i=t[e];e!==m?e!==f?(e in this.state?this.state:this.options)[e]=i:i&&this.setDuration(i):this.setEasing(i)}return this},s.getTotalDuration=function(){return this.state[w]===N?1/0:this.state[O]+this.getActiveDuration()},s.getActiveDuration=function(){return this.state[w]===N?1/0:this.getDuration()*this.state[w]},s.isEnded=function(){return 0===this.state.tickTime&&this.state[M]===c||!(this.getTime()<this.getActiveDuration())},s.isPaused=function(){return this.state[M]===c},s.setNext=function(t){return this.on(l,function(){t.play()}),this},s.play=function(){var e=this;return this.state[M]=S,this.isEnded()&&this.setTickTime(0),this.state.tickTime=this.getTime(),It(function(t){e.state.prevTime=t,e.tick(t)}),this.trigger(y),this},s.pause=function(){return this.state[M]=c,this.trigger(c),this},s.finish=function(){return this.state.tickTime=0,this.setTime(0),this.end(),this},s.end=function(){return this.pause(),this.trigger(l),this},s.setTime=function(t,e){var i=this.getActiveDuration(),r=e?t:this.getUnitTime(t);return this.state.tickTime=this.state.delay+r,r<0?r=0:i<r&&(r=i),this.state.currentTime=r,this.calculateIterationTime(),this.isDelay()||this.trigger(v,{currentTime:r,time:this.getIterationTime(),iterationCount:this.getIterationCount()}),this},s.getState=function(t){return this.state[t]},s.setState=function(t){for(var e in t)this.state[e]=t[e];return this},s.getTime=function(){return this.state.currentTime},s.getUnitTime=function(t){if(J(t)){var e=this.getDuration()||100;if("from"===t)return 0;if("to"===t)return e;var i=Q(t),r=i.unit,n=i.value;return"%"===r?(!this.getDuration()&&(this.state.duration=e),parseFloat(t)/100*e):">"===r?n+C:n}return gt(t)},s.isDelay=function(){var t=this.state,e=t.delay,i=t.tickTime;return 0<e&&i<e},s.setCurrentIterationCount=function(t){var e=this.state,i=Math.floor(t);return e.currentIterationCount<i&&this.trigger("iteration",{currentTime:e.currentTime,iterationCount:i}),e.currentIterationCount=t,this},s.calculateIterationTime=function(){var t=this.state,e=t.iterationCount,i=t.fillMode,r=t.direction,n=this.getDuration(),s=this.getTime(),a=0===n?0:s/n,o=n?s%n:0;if(!n)return this.setIterationTime(0),this;this.setCurrentIterationCount(a);var u=wt(a,e,r);(u&&(o=n-o),e!==N)&&(e<=a&&(o=n*("both"===i||"forwards"===i?e%1||1:0),u&&(o=n-o)));return this.setIterationTime(o),this},s.tick=function(t){var e=this,i=this.state,r=i.playSpeed,n=i.prevTime,s=this.state.tickTime+Math.min(1e3,t-n)/1e3*r;i.prevTime=t,this.setTickTime(s),this.isEnded()?this.end():i[M]!==c&&It(function(t){e.tick(t)})},s.setTickTime=function(t){this.setTime(t-this.state.delay,!0)},t=function(t,e,i,r){var n,s=arguments.length,a=s<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,i):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,e,i,r);else for(var o=t.length-1;0<=o;o--)(n=t[o])&&(a=(s<3?n(a):3<s?n(e,i,a):n(e,i))||a);return 3<s&&a&&Object.defineProperty(e,i,a),a}([(e=bt,r=Ot,n="state",function(t){var i=t.prototype;e.forEach(function(t){i[W("get "+t)]=function(){return this[n][t]}}),r.forEach(function(e){i[W("set "+e)]=function(t){return this[n][e]=t,this}})})],t)}(nt);function Ft(t){var e=z;return 3===t.length&&(t[3]=1),new pt(t,{model:e,separator:",",type:"color",prefix:e+"(",suffix:")"})}function kt(t,e){return new pt(t,{type:"array",separator:e})}function _t(t){if(!J(t))return Array.isArray(t)?kt(t,","):t;var e,i,r=B(t);return 1<r.length?kt(r.map(function(t){return _t(t)}),","):1<(r=t.match(/("[^"]*")|('[^']*')|([^\s()]*(?:\((?:[^()]*|\([^()]*\))*\))[^\s()]*)|\S+/g)||[]).length?kt(r.map(function(t){return _t(t)})," "):(r=/^(['"])([^'"]*)(['"])$/g.exec(t))&&r[1]===r[3]?new pt([_t(r[2])],{prefix:r[1],suffix:r[1]}):-1!==t.indexOf("(")?function(t){var e=G(t),i=e.prefix,r=e.value,n=e.suffix;if(void 0===r)return t;if(-1!==X.indexOf(i))return Ft(et(t));var s=_t(r),a=[r],o=",",u=i+"(",f=")"+n;return s instanceof pt&&(o=s.getOption("separator"),a=s.value,u+=s.getOption("prefix"),f=s.getOption("suffix")+f),new pt(a,{separator:o,model:i,prefix:u,suffix:f})}(t):"#"===t.charAt(0)?(i=et(e=t))?Ft(i):e:t}function At(t){if(!t)return"";var e=[];for(var i in t)e.push(i.replace(/\d/g,"")+"("+t[i]+")");return e.join(" ")}function Nt(t){return t instanceof pt}function Mt(t,e){return void 0===e&&(e=!1),jt({},t,e)}function jt(t,e,i){for(var r in void 0===i&&(i=!1),e){var n=e[r],s=dt(n);s===P?t[r]=i?n.toValue():n.clone():s===j?t[r]=i?Pt([r],n()):n:"array"===s?t[r]=n.slice():"object"===s?Z(t[r])&&!Nt(t[r])?jt(t[r],n,i):t[r]=Mt(n,i):t[r]=e[r]}return t}function Pt(t,e){var i=dt(e);if(i===P)return e.toValue();if(i===j){if(t[0]!==a)return Pt(t,e())}else if("object"===i)return Mt(e,!0);return e}var Lt=function(){function f(t){void 0===t&&(t={}),this.properties={},this.set(t)}var t=f.prototype;return t.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.raw.apply(this,t);return Pt(t[0]in h?h[t[0]]:t,i)},t.raw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var i=this.properties,r=(t[0]in h?h[t[0]]:t),n=r.length,s=0;s<n;++s){if(!Z(i))return;i=i[r[s]]}return i},t.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.properties,r=t[0]in h?h[t[0]]:t,n=r.length;if(!n)return this;for(var s=0;s<n-1;++s){if(!Z(i))return this;i=i[r[s]]}return delete i[r[n-1]],this},t.set=function(){for(var e=this,t=[],i=0;i<arguments.length;i++)t[i]=arguments[i];var r=t.length,n=t.slice(0,-1),s=t[r-1];if(n[0]in h)this._set(h[n[0]],s);else if(2===r&&H(n[0]))this._set(n[0],s);else if(Z(s))if(H(s))this._set(n,s);else if(Nt(s))St(n)?this.set.apply(this,n.concat([function e(t,i){void 0===i&&(i={});var r=t.getOption("model");if(r){t.setOptions({model:"",suffix:"",prefix:""});var n=1<t.size()?t:t.get(0);i[r]=n}else t.forEach(function(t){return e(t,i)});return i}(s)])):this._set(n,s);else if(s instanceof f)this.merge(s);else for(var a in s)this.set.apply(this,n.concat([a,s[a]]));else if(J(s)){if(St(n)){var o=_t(s);return Z(o)&&this.set.apply(this,n.concat([o])),this}var u=function(t){for(var e,i=t.split(";"),r=i.length,n=[],s=0;s<r;++s){var a=/([^:]*):([\S\s]*)/g.exec(i[s]);!a||a.length<3||!a[1]||n.push(((e={})[a[1].trim()]=_t(a[2].trim()),e))}return n}(s);if(u.forEach(function(t){e.set.apply(e,n.concat([t]))}),u.length)return this;this._set(n,s)}else this._set(n,s);return this},t.has=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var i=this.properties,r=t[0]in h?h[t[0]]:t,n=r.length;if(!n)return!1;for(var s=0;s<n;++s){if(!(Z(i)&&r[s]in i))return!1;i=i[r[s]]}return!0},t.clone=function(){var t=new f;return t.merge(this),t},t.merge=function(t){var e=this.properties,i=t.properties;return i&&jt(e,i),this},t.toObject=function(){return Mt(this.properties,!0)},t.toCSSObject=function(){var t=this.toObject(),e={};for(var i in t)if(!St([i],!0)){var r=t[i];i!==a?e[i]=r:e[a.replace("animation",K)]=(J(r)?r:r.easingName)||"initial"}var n=At(t.transform),s=At(t.filter);return V&&n&&(e[V]=n),q&&s&&(e[q]=s),e},t.toCSS=function(){var t=this.toCSSObject(),e=[];for(var i in t)e.push(i+":"+t[i]+";");return e.join("")},t._set=function(t,e){for(var i=this.properties,r=t.length,n=0;n<r-1;++n){var s=t[n];!(s in i)&&(i[s]={}),i=i[s]}r&&(i[t[r-1]]=J(e)?_t(e):e)},f}();var zt=function(){function t(){this.times=[],this.items={},this.names={}}var e=t.prototype;return e.getNames=function(){return function t(e,i){var r=[];for(var n in e)i.push(n),Z(e[n])?r=r.concat(t(e[n],i)):r.push(i.slice()),i.pop();return r}(this.names,[])},e.hasName=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return yt(this.names,t,!0)},e.update=function(){var t=this.items;for(var e in t)this.updateFrame(t[e]);return this},e.forEach=function(e){var t=this.times,i=this.items;t.forEach(function(t){e(i[t],t,i)})},e.updateFrame=function(t){if(!t)return this;var e=t.properties;return function t(e,i){for(var r in i){var n=i[r];!Z(n)||H(n)||n instanceof pt?e[r]=!0:(Z(e[r])||(e[r]={}),t(e[r],i[r]))}}(this.names,e),this},e.getDuration=function(){var t=this.times;return 0===t.length?0:t[t.length-1]},e.setDuration=function(t,e){void 0===e&&(e=this.getDuration());var i=t/e,r=this.times,n=this.items,s={};this.times=r.map(function(t){var e=gt(t*i);return s[e]=n[t],e}),this.items=s},e.unshift=function(i){var t=this.times,r=this.items,n={};return this.times=t.map(function(t){var e=gt(i+t);return n[e]=r[t],e}),this.items=n,this},e.size=function(){return this.times.length},e.add=function(t,e){return this.items[t]=e,this.addTime(t),this},e.has=function(t){return t in this.items},e.get=function(t){return this.items[t]},e.remove=function(t){return delete this.items[t],this.removeTime(t),this},e.addTime=function(t){for(var e=this.times,i=e.length,r=i,n=0;n<i;++n){if(t===e[n])return this;if(t<e[n]){r=n;break}}return this.times.splice(r,0,t),this},e.removeTime=function(t){var e=this.times.indexOf(t);return-1<e&&this.times.splice(e,1),this},t}();function Rt(t,i,r,n){if(0===n)return i;if(!H(i))return t;var s=i.length;return t.map(function(t,e){return s<=e?t:Vt(t,i[e],r,n)})}function Ut(t,e,i,r){var n=t.getOption("type");if("color"===n)return function(t,e,i,r){if(0===r)return e;var n=t.value,s=e.value,a=t.getOption("model");if(a!==e.getOption("model"))return Vt(t.toValue(),e.toValue(),i,r);3===n.length&&(n[3]=1),3===s.length&&(s[3]=1);for(var o=Rt(n,s,i,r),u=a,f=0;f<3;++f)o[f]=parseInt(o[f],10);return new pt(o,{type:"color",model:u,prefix:u+"(",suffix:")"})}(t,e,i,r);var s=Rt(t.value,e.value,i,r);return new pt(s,{type:n,separator:t.getOption("separator")||e.getOption("separator"),prefix:t.getOption("prefix")||e.getOption("prefix"),suffix:t.getOption("suffix")||e.getOption("suffix"),model:t.getOption("model")||e.getOption("model")})}function Vt(t,e,i,r){if(0===r)return e;if(0===i||i+r===0)return t;var n=dt(t),s=dt(e),a=n===j,o=s===j;if(a||o)return function(){return Vt(a?_t(t()):t,o?_t(e()):e,i,r)};if(n!==s)return t;if(n===P)return Ut(t,e,i,r);if("array"===n)return Rt(t,e,i,r);if("value"!==n)return t;var u,f=i/(i+r),h=1-f,c=Q(""+t),l=Q(""+e);if(isNaN(c.value)||isNaN(l.value))return t;u=c.value*h+l.value*f;var v=c.prefix||l.prefix,m=c.unit||l.unit;return v||m?v+u+m:u}function qt(t){var e=[];for(var i in t)e.push(K+"-"+i.replace(/([a-z])([A-Z])/g,function(t,e,i){return e+"-"+i.toLowerCase()})+" : "+t[i]+";");return e.join("")}var Kt=function(s){function v(t,e){var i=s.call(this)||this;return i.keyframes=new zt,i.elements=[],i.load(t,e),i}o(v,s);var t=v.prototype;return t.getDuration=function(){return Math.max(this.state[f],this.keyframes.getDuration())},t.setDuration=function(t){if(0===t)return this;var e=this.getDuration();return 0<e&&this.keyframes.setDuration(t,e),s.prototype.setDuration.call(this,gt(t)),this},t.setId=function(t){var e=this.elements,i=e.length;this.setState({id:t||function(t){for(;;){var e=""+Math.floor(1e5*Math.random());if(!t)return e;if(!document.querySelector('[data-scene-id="'+e+'"]'))return e}}(!!i)});var r=Et(this.getId());if(this.state.selector||(this.state.selector='[data-scene-id="'+r+'"]'),!i)return this;for(var n=0;n<i;++n)e[n].setAttribute("data-scene-id",r);return this},t.getId=function(){return this.state.id},t.set=function(e){for(var i=this,t=[],r=1;r<arguments.length;r++)t[r-1]=arguments[r];if(Z(e))return this.load(e),this;if(t[0]){if(t[0]instanceof v){var n=t[0],s=n.getDelay(),a=this.getUnitTime(e)+s,o=n.getAllTimes(!!s||!this.hasFrame(e)),u=o.keys,f=o.values,h=o.frames,c=this.getEasingName()!==n.getEasingName()?n.getEasing():0;return u.forEach(function(t){i.set(a+t,h[f[t]])}),c&&(this.set(a+u[0],m,c),this.set(a+u[u.length-1],m,"initial")),this}if(1===t.length&&H(t[0]))return t[0].forEach(function(t){i.set(e,t)}),this}var l=this.newFrame(e);return l.set.apply(l,t),this.updateFrame(l),this},t.get=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this.getFrame(t);return r&&r.get.apply(r,e)},t.remove=function(t){for(var e=[],i=1;i<arguments.length;i++)e[i-1]=arguments[i];var r=this.getFrame(t);return r&&r.remove.apply(r,e),this.update(),this},t.append=function(t){return this.set(this.getDuration(),t),this},t.prepend=function(t){if(t instanceof v){var e=t.getDelay(),i=(t.getIterationCount()===N?t.getDuration():t.getActiveDuration())+e,r=this.keyframes.get(0);r&&this.keyframes.remove(0),this.keyframes.unshift(i),this.set(0,t),this.set(i+C,r)}else this.prepend(new v(t));return this},t.setSelector=function(t){this.state.selector=!0===t?this.state.id:t||'[data-scene-id="'+this.state.id+'"]';var e=/([\s\S]+)(:+[a-zA-Z]+)$/g.exec(this.state.selector);return e&&(this.state.selector=e[1],this.state.peusdo=e[2]),this.setElement(document.querySelectorAll(this.state.selector)),this},t.setElement=function(t){return t&&(this.elements=t instanceof Element?[t]:t,this.setId(this.getId())),this},t.setCSS=function(t,e){return this.set(t,function(t,e){if(!t||!e||!e.length)return{};var i;if(t instanceof Element)i=t;else{if(!t.length)return{};i=t[0]}for(var r={},n=window.getComputedStyle(i),s=e.length,a=0;a<s;++a)r[e[a]]=n[e[a]];return r}(this.elements,e)),this},t.animate=function(t,e){return s.prototype.setTime.call(this,t,!0),this._animate(e)},t.setTime=function(t,e,i){return s.prototype.setTime.call(this,t,e),this._animate(i),this},t.update=function(){return this.keyframes.update(),this},t.updateFrame=function(t){return this.keyframes.updateFrame(t),this},t.newFrame=function(t){var e=this.getFrame(t);return e||(e=new Lt,this.setFrame(t,e),e)},t.setFrame=function(t,e){return this.keyframes.add(this.getUnitTime(t),e),this.keyframes.update(),this},t.getFrame=function(t){return this.keyframes.get(this.getUnitTime(t))},t.hasFrame=function(t){return this.keyframes.has(this.getUnitTime(t))},t.removeFrame=function(t){var e=this.keyframes;return e.remove(t),e.update(),this},t.copyFrame=function(t,e){if(Z(t)){for(var i in t)this.copyFrame(i,t[i]);return this}var r=this.getFrame(t);if(!r)return this;var n=r.clone();return this.setFrame(e,n),this},t.mergeFrame=function(t,e){if(Z(t)){for(var i in t)this.mergeFrame(i,t[i]);return this}var r=this.getFrame(t);return r&&this.newFrame(e).merge(r),this},t.getNowFrame=function(i,t){var r=this,n=new Lt,e=this.keyframes.getNames(),s=this._getNearTimeIndex(i),a=s.left,o=s.right,u=this._getEasing(i,a,o,this.getEasing()||t);return e.forEach(function(t){var e=r._getNowValue(i,a,o,t,u);Y(e)||n.set(t,e)}),n},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),H(t))for(var i=t.length,r=0;r<i;++r){var n=1===i?0:this.getUnitTime(r/(i-1)*100+"%");this.set(n,t[r])}else if(t.keyframes)this.set(t.keyframes);else for(var n in t)if("options"!==n&&"keyframes"!==n){var s=t[n],a=this.getUnitTime(n);"number"!=typeof s?this.set(a,s):this.mergeFrame(s,a)}return e&&this.setOptions(e),this},t.clone=function(t){void 0===t&&(t={});var i=new v;return i.setOptions(this.state),i.setOptions(t),this.keyframes.forEach(function(t,e){return i.setFrame(e,t.clone())}),i},t.setOptions=function(t){void 0===t&&(t={}),s.prototype.setOptions.call(this,t);var e=t.id,i=t.selector,r=t.duration,n=t.elements;return r&&this.setDuration(r),e&&this.setId(e),n?this.setElement(n):i&&this.setSelector(!0===i?this.state.id:i),this},t.getAllTimes=function(t,e){void 0===t&&(t=!0),void 0===e&&(e={});var i=this.keyframes.times.slice(),r=i.length,n=[],s={};if(!r)return{keys:[],values:{},frames:{}};var a={},o=this.getDuration(),u=e[I]||this.state[I],f=u===F||u===_;!this.getFrame(0)&&i.unshift(0),!this.getFrame(o)&&i.push(o),r=i.length;for(var h=e[w]||this.state[w],c=(h=h!==N?h:1)*o,l=0;l<h;++l)for(var v=wt(l,h,u),m=l*o,p=0;p<r;++p)if(!f||0===l||0!==p){var d=0!==p||(0===l?t:f)?0:C,g=gt(v?i[r-1-p]:i[p]),y=gt(m+gt(v?o-g:g)+d);if(c<y)break;if(n.push(y),!a[s[y]=g]){var S=this.getFrame(g);!S||0===p||p===r-1||S.has("transform")||S.has("filter")?a[g]=this.getNowFrame(g):a[g]=S}}if(n[n.length-1]<c){g=gt(o*((v=wt(h,h,u))?1-h%1:h%1));n.push(c),!a[s[c]=g]&&(a[g]=this.getNowFrame(g))}return{keys:n,values:s,frames:a}},t.toCSS=function(t,e){void 0===t&&(t=this.getDuration()),void 0===e&&(e={});var i=this.state,r=i.selector||this.options.selector;if(!r)return"";var n=i.peusdo||"",s=this._getId(),a=!Y(e[w]),o=0===t,u=o?this.getDuration():t,f=e[b]||1,h=((e[O]||0)+(o?i[O]:0))/f,c=i[m]&&i[p]||a&&e[m]&&e[p]||i[p],l=!o&&e[w]||i[w],v=qt({fillMode:"forwards"!==e[x]&&e[x]||i[x],direction:e[I]||i[I],iterationCount:l,delay:h+"s",name:E+"KEYFRAMES_"+Et(s),duration:u/f+"s",timingFunction:c});return r+"."+T+n+" {\n\t\t\t"+v+"\n\t\t}"+r+"."+D+n+" {\n      "+K+"-play-state: paused;\n    }\n\t\t"+this._toKeyframes(u,!o&&a)},t.exportCSS=function(t,e){if(void 0===t&&(t=this.getDuration()),void 0===e&&(e={}),!this.elements.length)return"";var i=this.toCSS(t,e);return!!Y(e[w])&&Tt(this._getId(),i),i},t.pause=function(){return s.prototype.pause.call(this),this.isPausedCSS()&&this.pauseCSS(),this},t.isPausedCSS=function(){return this.state.playCSS&&this.isPaused()},t.pauseCSS=function(){var t=this.elements,e=t.length;if(!e)return this;for(var i=0;i<e;++i)it(t[i],D)},t.endCSS=function(){var t=this.elements,e=t.length;if(!e)return this;for(var i=0;i<e;++i){var r=t[i];rt(r,D),rt(r,T)}this.setState({playCSS:!1})},t.end=function(){return!this.isEnded()&&this.state.playCSS&&this.endCSS(),s.prototype.end.call(this),this},t.playCSS=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e={}),Ct(this,t,e),this},t.addPlayClass=function(t,e){void 0===e&&(e={});var i=this.elements,r=i.length,n=qt(e);if(r){if(t)for(var s=0;s<r;++s)rt(i[s],D);else for(s=0;s<r;++s){var a=i[s];a.style.cssText+=n,u=T,((o=a).classList?o.classList.contains(u):o.className.match(new RegExp("(\\s|^)"+u+"(\\s|$)")))?(rt(a,T),function(t){requestAnimationFrame(function(){requestAnimationFrame(function(){it(t,T)})})}(a)):it(a,T)}var o,u;return i[0]}},t._getId=function(){return this.state.id||this.setId().getId()},t._getEasing=function(t,e,i,r){if(this.keyframes.hasName(a)){var n=this._getNowValue(t,e,i,[a],0,!0);return"function"==typeof n?n:r}return r},t._toKeyframes=function(i,t){void 0===i&&(i=this.getDuration());var e=this._getId(),r=this.state,n=r[b],s=r[w],a=r[x],o=t?r[O]:0,u=t?r[I]:A,f=u===k||u===_,h=this.getAllTimes(!0,{duration:i,delay:o,direction:u,iterationCount:t&&s!==N?s:1,isCSS:!0}),c=h.keys,l=h.values,v=h.frames,m=c.length,p={},d=[];if(!c.length)return"";for(var g in v)p[g]=v[g].toCSS();var y=c[m-1],S=p[l[y]];if(o){var T=!f||"both"!==a&&"backwards"!==a?p[0]:S;d.push("0%{}"),f&&d.push(o/n/i*100-C+"%{"+T+"}")}return c.forEach(function(t){var e=(o+t)/n/i*100;d.push(e+"%{"+(0===e?"":p[l[t]])+"}")}),(o+y)/n<i&&d.push("100%{"+S+"}"),"@"+$+" "+E+"KEYFRAMES_"+Et(e)+"{\n\t\t\t"+d.join("\n")+"\n\t\t}"},t._getNowValue=function(t,e,i,r,n,s){void 0===n&&(n=this.getEasing()),void 0===s&&(s=yt(g,r,!0));for(var a,o,u,f,h=this.keyframes,c=h.times,l=c.length,v=e;0<=v;--v){if((p=h.get(c[v])).has.apply(p,r)){a=c[v],u=p;break}}var m=u&&u.raw.apply(u,r);if(s)return m;for(v=i;v<l;++v){var p;if((p=h.get(c[v])).has.apply(p,r)){o=c[v],f=p;break}}var d=f&&f.raw.apply(f,r);return!u||Y(m)?d:!f||Y(d)||m===d?m:(a<0&&(a=0),function(t,e,i,r,n,s){if(t===e)return r;if(t===i)return n;if(!s)return Vt(r,n,t-e,i-t);var a=s((t-e)/(i-e));return Vt(r,n,a,1-a)}(t,a,o,m,d,n))},t._getNearTimeIndex=function(t){for(var e=this.keyframes.times,i=e.length,r=0;r<i;++r){if(e[r]===t)return{left:r,right:r};if(e[r]>t)return{left:0===r?0:r-1,right:r}}return{left:i-1,right:i-1}},t._animate=function(t){var e=this.getIterationTime(),i=this.getEasing()||t,r=this.getNowFrame(e,i),n=this.getTime();this.trigger("animate",{frame:r,currentTime:n,time:e});var s=this.elements,a=s.length;if(!a||this.state.peusdo)return r;var o=r.get("attribute");if(o)for(var u in o)for(var f=0;f<a;++f)s[f].setAttribute(u,o[u]);var h=r.toCSS();if(this.state.cssText!==h){this.state.cssText=h;for(f=0;f<a;++f)s[f].style.cssText+=h;return r}},v}(Dt),$t=function(r){function a(t,e){var i=r.call(this)||this;return i.items={},i.load(t,e),i}o(a,r);var t=a.prototype;return t.setId=function(t){return void 0===t&&(t="scene"+Math.floor(1e5*Math.random())),this.state.id=t,this},t.getId=function(){return this.state.id},t.getDuration=function(){var t=this.items,e=0;for(var i in t){var r=t[i];e=Math.max(e,r.getTotalDuration()/r.getPlaySpeed())}return e},t.setDuration=function(t){var e=this.items,i=this.getDuration();if(0===t||!isFinite(i))return this;if(0===i)for(var r in e){(s=e[r]).setDuration(t)}else{var n=t/i;for(var r in e){var s;(s=e[r]).setDelay(s.getDelay()*n),s.setDuration(s.getDuration()*n)}}return this},t.getItem=function(t){return this.items[t]},t.newItem=function(t,e){if(void 0===e&&(e={}),!(t in this.items)){var i=new Kt;return this.setItem(t,i),i.setOptions(e),i}},t.setItem=function(t,e){return e instanceof Dt&&e.setId(t),this.items[t]=e,this},t.animate=function(t,e){return r.prototype.setTime.call(this,t,!0),this._animate(e)},t.setTime=function(t,e,i){return r.prototype.setTime.call(this,t,e),this._animate(i),this},t.forEach=function(t){var e=this.items;for(var i in e)t(e[i],i,e);return this},t.exportCSS=function(t,e){void 0===t&&(t=this.getDuration());var i=this.items,r=e?this.getDuration():t;r&&isFinite(r)||(r=0);var n=!!e,s=[];for(var a in i){var o=i[a];s.push(o.exportCSS(r,this.state))}var u=s.join("");return!n&&Tt(this.getId()||this.setId().getId(),u),u},t.append=function(t){t.setDelay(t.getDelay()+this.getDuration()),this.setItem(t.getId()||t.setId().getId(),t)},t.isPausedCSS=function(){return this.state.playCSS&&this.isPaused()},t.pauseCSS=function(){var t=this.items;for(var e in t)t[e].pauseCSS()},t.pause=function(){return r.prototype.pause.call(this),this.isPausedCSS()&&this.pauseCSS(),this},t.endCSS=function(){var t=this.items;for(var e in t)t[e].endCSS();this.setState({playCSS:!1})},t.end=function(){return!this.isEnded()&&this.state.playCSS&&this.endCSS(),r.prototype.end.call(this),this},t.addPlayClass=function(t,e){void 0===e&&(e={});var i,r=this.items;for(var n in r){var s=r[n].addPlayClass(t,e);!i&&(i=s)}return i},t.playCSS=function(t,e){return void 0===t&&(t=!0),void 0===e&&(e={}),Ct(this,t,e),this},t.set=function(t){void 0===t&&(t={}),this.load(t)},t.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),!t)return this;var i=e&&e.selector;for(var r in t)if("options"!==r){var n=t[r],s=void 0;n instanceof a||n instanceof Kt?(this.setItem(r,n),s=n):(s=this.newItem(r)).load(n),i&&s.setSelector(r)}this.setOptions(e)},t.setSelector=function(t){var i=this.options.selector;this.forEach(function(t,e){t.setSelector(!!i&&e)})},t._animate=function(t){var e=this.getIterationTime(),i=this.items,r=this.getEasing()||t,n={};for(var s in i){var a=i[s];n[s]=a.animate(Math.max(e*a.getPlaySpeed()-a.getDelay(),0),r)}return this.trigger(d,{currentTime:this.getTime(),time:e,frames:n}),n},a}(Dt);function Yt(t,e,i){for(var r=new Kt({},i),n=e.length,s=0;s<n;++s)r.set(s/(n-1)*100+"%",t,e[s]);return r}var Zt={VERSION:"1.0.0-beta12",SceneItem:Kt,Frame:Lt,Animator:Dt,Keyframes:zt,PropertyObject:pt,default:$t,bezier:at,EASE_IN_OUT:mt,EASE_IN:lt,EASE_OUT:vt,EASE:ct,LINEAR:ht,steps:ot,STEP_START:ut,STEP_END:ft,set:Yt,transition:function(t,e,i){var r,n,s=i.from,a=i.to,o=i.duration,u=void 0===o?t.getDuration():o,f=i.time,h=void 0===f?Math.max(t.getDuration()-u,0):f;t.set(((r={})[h]=s,r[h+u]=a,r)),e.set(((n={0:a})[u]=s,n))},wipeIn:function(t){var e=t.from,i=void 0===e?"-100%":e,r=t.to,n=void 0===r?"0%":r,s=t.property;return Yt(void 0===s?"left":s,[i,n],t)},wipeOut:function(t){var e=t.from,i=void 0===e?"0%":e,r=t.to,n=void 0===r?"100%":r,s=t.property;return Yt(void 0===s?"left":s,[i,n],t)},fadeIn:function(t){var e=t.from,i=void 0===e?0:e,r=t.to;return Yt("opacity",[i,void 0===r?1:r],t)},fadeOut:function(t){var e=t.from,i=void 0===e?1:e,r=t.to;return Yt("opacity",[i,void 0===r?0:r],t)},blink:function(t){var e=t.from,i=void 0===e?0:e,r=t.to;return Yt("opacity",[i,void 0===r?1:r,i],t)},zoomIn:function(t){var e=t.from,i=void 0===e?0:e,r=t.to;return Yt(["transform","scale"],[i,void 0===r?1:r],t)},zoomOut:function(t){var e=t.from,i=void 0===e?1:e,r=t.to;return Yt(["transform","scale"],[i,void 0===r?0:r],t)},OPTIONS:t,EVENTS:e,setRole:function(t,e,i){for(var r=t.length,n=u,s=g,a=0;a<r-1;++a)!n[t[a]]&&(n[t[a]]={}),n=n[t[a]],i&&(!s[t[a]]&&(s[t[a]]={}),s=s[t[a]]);i&&(s[t[r-1]]=!0),n[t[r-1]]=!!e||{}},setAlias:function(t,e){h[t]=e}};for(var Ht in Zt)$t[Ht]=Zt[Ht];return $t});
//# sourceMappingURL=scene.min.js.map
