!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Scene=e()}(this,function(){"use strict";var i=function(t,e){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r])})(t,e)};function a(t,e){function r(){this.constructor=t}i(t,e),t.prototype=null===e?Object.create(e):(r.prototype=e.prototype,new r)}var y="__SCENEJS_",s="animation-timing-function",u={transform:{},filter:{},attribute:{}},h={easing:["animation-timing-function"]},d={"animation-timing-function":!0,contents:!0},T=1e-6,f="duration",c="fillMode",E="direction",x="iterationCount",S="delay",l="easing",w="playSpeed",v="easingName",p="paused",m="ended",o="timeupdate",g="animate",O="play",I="running",b="iteration",D="rgba",_="startAnimation",F="alternate",k="reverse",C="alternate-reverse",N="normal",A="infinite",M="playState",t=[f,c,E,x,S,l,w],e=[p,m,o,g,O,b],j=["webkit","ms","moz","o"],r=function(t){var e=(document.body||document.documentElement).style,r=j.length;if(void 0!==e[t])return t;for(var i=0;i<r;++i){var n="-"+j[i]+"-"+t;if(void 0!==e[n])return n}return""},P=r("transform"),L=r("filter"),R=r("animation"),z=R.replace("animation","keyframes"),n=function(){function t(){this.events={}}return t.prototype.on=function(e,t){var r=this,i=this.events;if("object"!=typeof e)return e in i||(i[e]=[]),t&&("object"==typeof t?t.forEach(function(t){return r.on(e,t)}):i[e].push(t)),this;for(var n in e)this.on(n,e[n]);return this},t.prototype.off=function(t,e){if(t)if(e){var r=this.events[t];if(!r)return this;var i=r.indexOf(e);-1!==i&&r.splice(i,1)}else this.events[t]=[];else this.events={};return this},t.prototype.trigger=function(t){for(var e=this,r=[],i=1;i<arguments.length;i++)r[i-1]=arguments[i];var n=this.events;if(!(t in n))return this;var o=n[t];if(r.length){var s=r[0];s.type=t,s.currentTarget=this,!s.target&&(s.target=this)}return o.forEach(function(t){t.apply(e,r)}),this},t}();function V(t,e,r){var i=1-r;return r*r*r+3*r*r*i*e+3*r*i*i*t}function U(r,i,n,o){var t=function(t){var e=function(t,e,r){for(var i=r,n=1;.001<Math.abs(n);){if(n=V(t,e,i)-r,Math.abs(n)<.001)return i;i-=n/2}return i}(r,n,Math.max(Math.min(1,t),0));return V(i,o,e)};return t.easingName="cubic-bezier("+r+","+i+","+n+","+o+")",t}function q(r,i){var t=function(t){var e=1/r;return("end"===i?e:0)+Math.floor(t/e)*e};return t.easingName="steps("+r+", "+i+")",t}var K=q(1,"start"),$=q(1,"end"),Y=U(0,0,1,1),Z=U(.25,.1,.25,1),H=U(.42,0,1,1),J=U(0,0,.58,1),B=U(.42,0,.58,1),G=function(){function e(t,e){void 0===e&&(e={}),this.options={prefix:"",suffix:"",model:"",type:"",separator:","},this.setOptions(e),this.init(t)}return e.prototype.setOptions=function(t){return Object.assign(this.options,t),this},e.prototype.getOption=function(t){return this.options[t]},e.prototype.size=function(){return this.value.length},e.prototype.get=function(t){return this.value[t]},e.prototype.set=function(t,e){return this.value[t]=e,this},e.prototype.clone=function(){return new e(this.value.map(function(t){return t instanceof e?t.clone():t}),{separator:this.options.separator,prefix:this.options.prefix,suffix:this.options.suffix,model:this.options.model,type:this.options.type})},e.prototype.toValue=function(){return this.options.prefix+this.join()+this.options.suffix},e.prototype.join=function(){return this.value.map(function(t){return t instanceof e?t.toValue():t}).join(this.options.separator)},e.prototype.forEach=function(t){return this.value.forEach(t),this},e.prototype.init=function(t){var e=typeof t;return this.value="string"===e?t.split(this.options.separator):"object"===e?t:[t],this},e}();function Q(t){var e=typeof t;if("object"===e){if(it(t))return"array";if(t instanceof G)return"property"}else if("string"===e||"number"===e)return"value";return e}function W(t){return Math.round(1e6*t)/1e6}function X(t,e,r){var i=e.length,n=t;if(0===i)return!1;for(var o=0;o<i;++o){if(!0===n)return!1;if(!(n=n[e[o]])||!r&&!0===n)return!1}return!0}function tt(t,e){return X(u,t,e)}function et(t){return void 0===t}function rt(t){return t&&"object"==typeof t}function it(t){return Array.isArray(t)}function nt(t){return"string"==typeof t}function ot(t){var e=/^([^\d|e|\-|\+]*)((?:\d|\.|-|e-|e\+)+)(\S*)$/g.exec(t);if(!e)return{prefix:"",unit:"",value:NaN};var r=e[1],i=e[2];return{prefix:r,unit:e[3],value:parseFloat(i)}}var st=0;function at(t){return t.replace(/[\s-_]([a-z])/g,function(t,e){return e.toUpperCase()})}var ut=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){var e=Date.now(),r=Math.max(0,16-(e-st)),i=window.setTimeout(function(){t(e+r)},1e3/60);return st=e+r,i}}();function ft(t,e){return e===k||e===(1<=t%2?F:C)}var ht=[x,S,c,E,w,f,w,"iterationTime",M],pt=ht.concat([l,v]),ct=function(r){function t(t){var e=r.call(this)||this;return e.options={},e.state={id:"",easing:0,easingName:"linear",iterationCount:1,delay:0,fillMode:"forwards",direction:N,playSpeed:1,currentTime:0,iterationTime:-1,currentIterationCount:0,tickTime:0,prevTime:0,playState:p,duration:0},e.setOptions(t),e}var e,i,n;return a(t,r),t.prototype.setEasing=function(t){var e=Array.isArray(t)?U(t[0],t[1],t[2],t[3]):t,r=e[v]||"linear";return this.setState({easing:e,easingName:r}),this},t.prototype.setOptions=function(t){for(var e in void 0===t&&(t={}),t){var r=t[e];e!==l?e!==f?(e in this.state?this.state:this.options)[e]=r:r&&this.setDuration(r):this.setEasing(r)}return this},t.prototype.getTotalDuration=function(){return this.state[x]===A?1/0:this.state[S]+this.getActiveDuration()},t.prototype.getActiveDuration=function(){return this.state[x]===A?1/0:this.getDuration()*this.state[x]},t.prototype.isEnded=function(){return 0===this.state.tickTime&&this.state[M]===p||!(this.getTime()<this.getActiveDuration())},t.prototype.isPaused=function(){return this.state[M]===p},t.prototype.setNext=function(t){return this.on(m,function(){t.play()}),this},t.prototype.play=function(){var e=this;return this.state[M]=I,this.isEnded()&&this.setTickTime(0),this.state.tickTime=this.getTime(),ut(function(t){e.state.prevTime=t,e.tick(t)}),this.trigger(O),this},t.prototype.pause=function(){return this.state[M]=p,this.trigger(p),this},t.prototype.end=function(){return this.pause(),this.trigger(m),this},t.prototype.reset=function(){return this.state.tickTime=0,this.setTime(0),this.pause(),this},t.prototype.setTime=function(t,e){var r=this.getActiveDuration(),i=e?t:this.getUnitTime(t);return this.state.tickTime=this.state.delay+i,i<0?i=0:r<i&&(i=r),this.state.currentTime=i,this.calculateIterationTime(),this.isDelay()||this.trigger(o,{currentTime:i,time:this.getIterationTime(),iterationCount:this.getIterationCount()}),this},t.prototype.getState=function(t){return this.state[t]},t.prototype.setState=function(t){for(var e in t)this.state[e]=t[e];return this},t.prototype.getTime=function(){return this.state.currentTime},t.prototype.getUnitTime=function(t){if(nt(t)){var e=this.getDuration()||100;if("from"===t)return 0;if("to"===t)return e;var r=ot(t),i=r.unit,n=r.value;return"%"===i?(!this.getDuration()&&(this.state.duration=e),parseFloat(t)/100*e):">"===i?n+T:n}return W(t)},t.prototype.isDelay=function(){var t=this.state,e=t.delay,r=t.tickTime;return 0<e&&r<e},t.prototype.setCurrentIterationCount=function(t){var e=this.state,r=Math.floor(t);return e.currentIterationCount<r&&this.trigger("iteration",{currentTime:e.currentTime,iterationCount:r}),e.currentIterationCount=t,this},t.prototype.calculateIterationTime=function(){var t=this.state,e=t.iterationCount,r=t.fillMode,i=t.direction,n=this.getDuration(),o=this.getTime(),s=0===n?0:o/n,a=n?o%n:0;if(!n)return this.setIterationTime(0),this;this.setCurrentIterationCount(s);var u=ft(s,i);(u&&(a=n-a),e!==A)&&(e<=s&&(a=n*("both"===r||"forwards"===r?e%1||1:0),u&&(a=n-a)));return this.setIterationTime(a),this},t.prototype.tick=function(t){var e=this,r=this.state,i=r.playSpeed,n=r.prevTime,o=this.state.tickTime+Math.min(1e3,t-n)/1e3*i;r.prevTime=t,this.setTickTime(o),this.isEnded()?this.end():r[M]!==p&&ut(function(t){e.tick(t)})},t.prototype.setTickTime=function(t){this.setTime(t-this.state.delay,!0)},t=function(t,e,r,i){var n,o=arguments.length,s=o<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(t,e,r,i);else for(var a=t.length-1;0<=a;a--)(n=t[a])&&(s=(o<3?n(s):3<o?n(e,r,s):n(e,r))||s);return 3<o&&s&&Object.defineProperty(e,r,s),s}([(e=pt,i=ht,n="state",function(t){var r=t.prototype;e.forEach(function(t){r[at("get "+t)]=function(){return this[n][t]}}),i.forEach(function(e){r[at("set "+e)]=function(t){return this[n][e]=t,this}})})],t)}(n),mt=["rgb",D,"hsl","hsla"];function lt(t){var e,r="#"===(e=t).charAt(0)?e.substring(1):e,i=parseInt(r.substring(0,2),16),n=parseInt(r.substring(2,4),16),o=parseInt(r.substring(4,6),16),s=parseInt(r.substring(6,8),16)/255;return isNaN(s)&&(s=1),[i,n,o,s]}function vt(t){var e=D;return 3===t.length&&(t[3]=1),new G(t,{model:e,separator:",",type:"color",prefix:e+"(",suffix:")"})}function gt(t){var e;if(t instanceof G)e=t;else if(it(t))e=vt(t);else if(nt(t))return St(t);var r=e.value,i=r.length;4===i?r[3]=parseFloat(r[3]):3===i&&(r[3]=1),e.setOptions({type:"color"});var n=e.getOption("model").toLowerCase();switch("rgb"===n&&e.setOptions({type:"color",model:D,prefix:D+"(",suffix:")"}),n){case"rgb":case D:for(var o=0;o<3;++o)r[o]=parseInt(r[o],10);break;case"hsl":case"hsla":for(o=1;o<3;++o)-1!==r[o].indexOf("%")&&(r[o]=parseFloat(r[o])/100);return vt(r=function(t){var e=t[0],r=t[1],i=t[2];e<0&&(e+=360*Math.floor((Math.abs(e)+360)/360)),e%=360;var n,o=(1-Math.abs(2*i-1))*r,s=o*(1-Math.abs(e/60%2-1)),a=i-o/2;e<60?n=[o,s,0]:e<120?n=[s,o,0]:e<180?n=[0,o,s]:e<240?n=[0,s,o]:e<300?n=[s,0,o]:e<360&&(n=[o,0,s]);var u=[Math.round(255*(n[0]+a)),Math.round(255*(n[1]+a)),Math.round(255*(n[2]+a))];return 3<t.length&&(u[3]=t[3]),u}(r))}return e}function yt(t){var e=/([^(]*)\(([\s\S]*)\)([\s\S]*)/g.exec(t);if(!e||e.length<4)return t;var r,i=e[1]||"",n=e[2],o=i+"(",s=")"+e[3],a=",",u=Tt(n);u instanceof G?(a=u.getOption("separator"),r=u.value,o+=u.getOption("prefix"),s=u.getOption("suffix")+s):r=[n];var f=new G(r,{separator:a,model:i,prefix:o,suffix:s});return-1!==mt.indexOf(i)?gt(f):f}function dt(t,e){return new G(t,{type:"array",separator:e})}function St(t){var e,r,i,n;if("#"===t.charAt(0))return vt(4===t.length?lt((r=(e=t).charAt(1),i=e.charAt(2),n=e.charAt(3),["#",r,r,i,i,n,n].join(""))):lt(t));if(-1!==t.indexOf("("))return yt(t);throw new Error("Invalid Format : Not a Color - "+t)}function Tt(t){if(!nt(t))return Array.isArray(t)?dt(t,","):t;var e,r=(e=t.match(/("[^"]*"|'[^']*'|[^,\s()]*\((?:[^()]*|\([^()]*\))*\)[^,\s()]*|[^,])+/g))?e.map(function(t){return t.trim()}):[];return 1<r.length?dt(r.map(function(t){return Tt(t)}),","):1<(r=t.match(/("[^"]*")|('[^']*')|([^\s()]*(?:\((?:[^()]*|\([^()]*\))*\))[^\s()]*)|\S+/g)||[]).length?dt(r.map(function(t){return Tt(t)})," "):(r=/^(['"])([^'"]*)(['"])$/g.exec(t))&&r[1]===r[3]?new G([Tt(r[2])],{prefix:r[1],suffix:r[1]}):-1!==t.indexOf("(")?yt(t):"#"===t.charAt(0)?St(t):t}function Et(t){if(!t)return"";var e=[];for(var r in t)e.push(r+"("+t[r]+")");return e.join(" ")}function xt(t,e){return void 0===e&&(e=!1),wt({},t,e)}function wt(t,e,r){for(var i in void 0===r&&(r=!1),e){var n=e[i],o=Q(n);"property"===o?t[i]=r?n.toValue():n.clone():"array"===o?t[i]=n.slice():"object"===o?!rt(t[i])||t[i]instanceof G?t[i]=xt(n,r):wt(t[i],n,r):t[i]=e[i]}return t}var Ot=function(){function f(t){void 0===t&&(t={}),this.properties={},this.set(t)}return f.prototype.get=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.raw.apply(this,t),i=Q(r);return"property"===i?r.toValue():"object"===i?xt(r,!0):r},f.prototype.raw=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var r=this.properties,i=(t[0]in h?h[t[0]]:t),n=i.length,o=0;o<n;++o){if(!rt(r))return;r=r[i[o]]}return r},f.prototype.remove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.properties,i=t[0]in h?h[t[0]]:t,n=i.length;if(!n)return this;for(var o=0;o<n-1;++o){if(!rt(r))return this;r=r[i[o]]}return delete r[i[n-1]],this},f.prototype.set=function(){for(var e=this,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];var i=t.length,n=t.slice(0,-1),o=t[i-1];if(n[0]in h)this._set(h[n[0]],o);else if(2===i&&it(n[0]))this._set(n[0],o);else if(rt(o))if(it(o))this._set(n,o);else if(o instanceof G)tt(n)?this.set.apply(this,n.concat([function e(t,r){void 0===r&&(r={});var i=t.getOption("model");if(i){t.setOptions({model:"",suffix:"",prefix:""});var n=1<t.size()?t:t.get(0);r[i]=n}else t.forEach(function(t){return e(t,r)});return r}(o)])):this._set(n,o);else if(o instanceof f)this.merge(o);else for(var s in o)this.set.apply(this,n.concat([s,o[s]]));else if(nt(o)){if(tt(n)){var a=Tt(o);return rt(a)&&this.set.apply(this,n.concat([a])),this}var u=function(t){for(var e,r=t.split(";"),i=r.length,n=[],o=0;o<i;++o){var s=/([^:]*):([\S\s]*)/g.exec(r[o]);!s||s.length<3||!s[1]||n.push(((e={})[s[1].trim()]=Tt(s[2].trim()),e))}return n}(o);if(u.forEach(function(t){e.set.apply(e,n.concat([t]))}),u.length)return this;this._set(n,o)}else this._set(n,o);return this},f.prototype.has=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=this.properties,i=t[0]in h?h[t[0]]:t,n=i.length;if(!n)return!1;for(var o=0;o<n;++o){if(!(rt(r)&&i[o]in r))return!1;r=r[i[o]]}return!0},f.prototype.clone=function(){var t=new f;return t.merge(this),t},f.prototype.merge=function(t){var e=this.properties,r=t.properties;return r&&wt(e,r),this},f.prototype.toObject=function(){return xt(this.properties,!0)},f.prototype.toCSSObject=function(){var t=this.toObject(),e={};for(var r in t)if(!tt([r],!0)){var i=t[r];r!==s?e[r]=i:e[s.replace("animation",R)]=(nt(i)?i:i.easingName)||"initial"}var n=Et(t.transform),o=Et(t.filter);return P&&n&&(e[P]=n),L&&o&&(e[L]=o),e},f.prototype.toCSS=function(){var t=this.toCSSObject(),e=[];for(var r in t)e.push(r+":"+t[r]+";");return e.join("")},f.prototype._set=function(t,e){for(var r=this.properties,i=t.length,n=0;n<i-1;++n){var o=t[n];!(o in r)&&(r[o]={}),r=r[o]}i&&(r[t[i-1]]=nt(e)?Tt(e):e)},f}();var It=function(){function t(){this.times=[],this.items={},this.names={}}return t.prototype.getNames=function(){return function t(e,r){var i=[];for(var n in e)r.push(n),rt(e[n])?i=i.concat(t(e[n],r)):i.push(r.slice()),r.pop();return i}(this.names,[])},t.prototype.hasName=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return X(this.names,t,!0)},t.prototype.update=function(){var t=this.items;for(var e in t)this.updateFrame(t[e]);return this},t.prototype.forEach=function(e){var t=this.times,r=this.items;t.forEach(function(t){e(r[t],t,r)})},t.prototype.updateFrame=function(t){if(!t)return this;var e=t.properties;return function t(e,r){for(var i in r){var n=r[i];!rt(n)||it(n)||n instanceof G?e[i]=!0:(rt(e[i])||(e[i]={}),t(e[i],r[i]))}}(this.names,e),this},t.prototype.getDuration=function(){var t=this.times;return 0===t.length?0:t[t.length-1]},t.prototype.setDuration=function(t,e){void 0===e&&(e=this.getDuration());var r=t/e,i=this.times,n=this.items,o={};this.times=i.map(function(t){var e=W(t*r);return o[e]=n[t],e}),this.items=o},t.prototype.unshift=function(r){var t=this.times,i=this.items,n={};return this.times=t.map(function(t){var e=W(r+t);return n[e]=i[t],e}),this.items=n,this},t.prototype.size=function(){return this.times.length},t.prototype.add=function(t,e){return this.items[t]=e,this.addTime(t),this},t.prototype.has=function(t){return t in this.items},t.prototype.get=function(t){return this.items[t]},t.prototype.remove=function(t){return delete this.items[t],this.removeTime(t),this},t.prototype.addTime=function(t){for(var e=this.times,r=e.length,i=r,n=0;n<r;++n){if(t===e[n])return this;if(t<e[n]){i=n;break}}return this.times.splice(i,0,t),this},t.prototype.removeTime=function(t){var e=this.times.indexOf(t);return-1<e&&this.times.splice(e,1),this},t}();function bt(t,r,i,n){if(0===n)return r;if(!it(r))return t;var o=r.length;return t.map(function(t,e){return o<=e?t:_t(t,r[e],i,n)})}function Dt(t,e,r,i){var n=t.getOption("type");if("color"===n)return function(t,e,r,i){if(0===i)return e;var n=t.value,o=e.value,s=t.getOption("model");if(s!==e.getOption("model"))return _t(t.toValue(),e.toValue(),r,i);3===n.length&&(n[3]=1),3===o.length&&(o[3]=1);for(var a=bt(n,o,r,i),u=s,f=0;f<3;++f)a[f]=parseInt(a[f],10);return new G(a,{type:"color",model:u,prefix:u+"(",suffix:")"})}(t,e,r,i);var o=bt(t.value,e.value,r,i);return new G(o,{type:n,separator:t.getOption("separator")||e.getOption("separator"),prefix:t.getOption("prefix")||e.getOption("prefix"),suffix:t.getOption("suffix")||e.getOption("suffix"),model:t.getOption("model")||e.getOption("model")})}function _t(t,e,r,i){if(0===i)return e;if(0===r||r+i===0)return t;var n=Q(t);if(n!==Q(e))return t;if("property"===n)return Dt(t,e,r,i);if("array"===n)return bt(t,e,r,i);if("value"!==n)return t;var o,s=r/(r+i),a=1-s,u=ot(""+t),f=ot(""+e);if(isNaN(u.value)||isNaN(f.value))return t;o=u.value*a+f.value*s;var h=u.prefix||f.prefix,p=u.unit||f.unit;return h||p?h+o+p:o}function Ft(t,e){t.classList?t.classList.add(e):t.className+=" "+e}function kt(t,e){if(t.classList)t.classList.remove(e);else{var r=new RegExp("(\\s|^)"+e+"(\\s|$)");t.className=t.className.replace(r," ")}}function Ct(t){return t.match(/[0-9a-zA-Z]+/g).join("")}function Nt(t){var e=[];for(var r in t)e.push(R+"-"+r.replace(/([a-z])([A-Z])/g,function(t,e,r){return e+"-"+r.toLowerCase()})+" : "+t[r]+";");return e.join("")}var At=function(o){function m(t,e){var r=o.call(this)||this;return r.keyframes=new It,r.elements=[],r.load(t,e),r}return a(m,o),m.prototype.getDuration=function(){return Math.max(this.state[f],this.keyframes.getDuration())},m.prototype.setDuration=function(t){if(0===t)return this;var e=this.getDuration();return 0<e&&this.keyframes.setDuration(t,e),o.prototype.setDuration.call(this,W(t)),this},m.prototype.setId=function(t){var e=this.elements,r=e.length;this.setState({id:t||function(t){for(;;){var e=""+Math.floor(1e5*Math.random());if(!t)return e;if(!document.querySelector('[data-scene-id="'+e+'"]'))return e}}(!!r)});var i=Ct(this.getId());if(this.options.selector||(this.options.selector='[data-scene-id="'+i+'"]'),!r)return this;for(var n=0;n<r;++n)e[n].setAttribute("data-scene-id",i);return this},m.prototype.getId=function(){return this.state.id},m.prototype.set=function(e){for(var r=this,t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];if(rt(e))return this.load(e),this;if(t[0]){if(t[0]instanceof m){var n=t[0],o=n.getDelay(),s=this.getUnitTime(e)+o,a=n.getAllTimes(!!o||!this.hasFrame(e)),u=a.keys,f=a.values,h=a.frames,p=this.getEasingName()!==n.getEasingName()?n.getEasing():0;return u.forEach(function(t){r.set(s+t,h[f[t]])}),p&&(this.set(s+u[0],l,p),this.set(s+u[u.length-1],l,"initial")),this}if(1===t.length&&it(t[0]))return t[0].forEach(function(t){r.set(e,t)}),this}var c=this.newFrame(e);return c.set.apply(c,t),this.updateFrame(c),this},m.prototype.get=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=this.getFrame(t);return i&&i.get.apply(i,e)},m.prototype.remove=function(t){for(var e=[],r=1;r<arguments.length;r++)e[r-1]=arguments[r];var i=this.getFrame(t);return i&&i.remove.apply(i,e),this.update(),this},m.prototype.append=function(t){return this.set(this.getDuration(),t),this},m.prototype.prepend=function(t){if(t instanceof m){var e=t.getDelay(),r=(t.getIterationCount()===A?t.getDuration():t.getActiveDuration())+e,i=this.keyframes.get(0);i&&this.keyframes.remove(0),this.keyframes.unshift(r),this.set(0,t),this.set(r+T,i)}else this.prepend(new m(t));return this},m.prototype.setSelector=function(t){return this.options.selector=!0===t?this.state.id:t||'[data-scene-id="'+this.state.id+'"]',this.setElement(document.querySelectorAll(this.options.selector)),this},m.prototype.setElement=function(t){return t&&(this.elements=t instanceof Element?[t]:t,this.setId()),this},m.prototype.setCSS=function(t,e){return this.set(t,function(t,e){if(!t||!e||!e.length)return{};var r;if(t instanceof Element)r=t;else{if(!t.length)return{};r=t[0]}for(var i={},n=window.getComputedStyle(r),o=e.length,s=0;s<o;++s)i[e[s]]=n[e[s]];return i}(this.elements,e)),this},m.prototype.animate=function(t,e){return o.prototype.setTime.call(this,t,!0),this._animate(e)},m.prototype.setTime=function(t,e,r){return o.prototype.setTime.call(this,t,e),this._animate(r),this},m.prototype.update=function(){return this.keyframes.update(),this},m.prototype.updateFrame=function(t){return this.keyframes.updateFrame(t),this},m.prototype.newFrame=function(t){var e=this.getFrame(t);return e||(e=new Ot,this.setFrame(t,e),e)},m.prototype.setFrame=function(t,e){return this.keyframes.add(this.getUnitTime(t),e),this.keyframes.update(),this},m.prototype.getFrame=function(t){return this.keyframes.get(this.getUnitTime(t))},m.prototype.hasFrame=function(t){return this.keyframes.has(this.getUnitTime(t))},m.prototype.removeFrame=function(t){var e=this.keyframes;return e.remove(t),e.update(),this},m.prototype.copyFrame=function(t,e){if(rt(t)){for(var r in t)this.copyFrame(r,t[r]);return this}var i=this.getFrame(t);if(!i)return this;var n=i.clone();return this.setFrame(e,n),this},m.prototype.mergeFrame=function(t,e){if(rt(t)){for(var r in t)this.mergeFrame(r,t[r]);return this}var i=this.getFrame(t);return i&&this.newFrame(e).merge(i),this},m.prototype.getNowFrame=function(r,t){var i=this,n=new Ot,e=this.keyframes.getNames(),o=this._getNearTimeIndex(r),s=o.left,a=o.right,u=this._getEasing(r,s,a,this.getEasing()||t);return e.forEach(function(t){var e=i._getNowValue(r,s,a,t,u);et(e)||n.set(t,e)}),n},m.prototype.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),it(t))for(var r=t.length,i=0;i<r;++i){var n=1===r?0:this.getUnitTime(i/(r-1)*100+"%");this.set(n,t[i])}else if(t.keyframes)this.set(t.keyframes);else for(var n in t)if("options"!==n&&"keyframes"!==n){var o=t[n],s=this.getUnitTime(n);"number"!=typeof o?this.set(s,o):this.mergeFrame(o,s)}return e&&this.setOptions(e),this},m.prototype.clone=function(t){void 0===t&&(t={});var r=new m;return r.setOptions(this.state),r.setOptions(t),this.keyframes.forEach(function(t,e){return r.setFrame(e,t.clone())}),r},m.prototype.setOptions=function(t){void 0===t&&(t={}),o.prototype.setOptions.call(this,t);var e=t.id,r=t.selector,i=t.duration,n=t.elements;return i&&this.setDuration(i),e&&this.setId(e),n?this.setElement(n):r&&this.setSelector(!0===r?this.state.id:r),this},m.prototype.getAllTimes=function(t,e){void 0===t&&(t=!0),void 0===e&&(e={});var r=this.keyframes.times.slice(),i=r.length,n=[],o={};if(!i)return{keys:[],values:{},frames:{}};var s={},a=this.getDuration(),u=e[E]||this.state[E],f=u===F||u===C;!this.getFrame(0)&&r.unshift(0),!this.getFrame(a)&&r.push(a),i=r.length;for(var h=e[x]||this.state[x],p=(h=h!==A?h:1)*a,c=0;c<h;++c)for(var m=ft(c,u),l=c*a,v=0;v<i;++v)if(!f||0===c||0!==v){var g=0!==v||(0===c?t:f)?0:T,y=W(m?r[i-1-v]:r[v]),d=W(l+W(m?a-y:y)+g);if(p<d)break;if(n.push(d),!s[o[d]=y]){var S=this.getFrame(y);if(!S){s[y]=this.getNowFrame(y);continue}0===v||v===i-1||S.has("transform")||S.has("filter")?s[y]=this.getNowFrame(y):s[y]=S}}if(n[n.length-1]<p){y=W(a*((m=ft(h,u))?1-h%1:h%1));n.push(p),!s[o[p]=y]&&(s[y]=this.getNowFrame(y))}return{keys:n,values:o,frames:s}},m.prototype.toCSS=function(t,e){void 0===t&&(t=this.getDuration()),void 0===e&&(e={});var r=this.state,i=r.selector||this.options.selector;if(!i)return"";var n=this._getId(),o=void 0===e[x],s=0===t,a=e[w]||1,u=((o?r[S]:e[S])||0)/a,f=!s&&e[l]&&e[v]||r[v],h=!s&&e[x]||r[x],p=Nt({fillMode:"forwards"!==e[c]&&e[c]||r[c],direction:e[E]!==N&&e[E]||r[E],iterationCount:h,delay:u+"s",name:y+"KEYFRAMES_"+Ct(n),duration:t/a+"s",timingFunction:f});return i+"."+_+" {\n\t\t\t"+p+"\n\t\t}\n\t\t"+this._toKeyframes(t,o)},m.prototype.exportCSS=function(t,e){if(void 0===t&&(t=this.getDuration()),void 0===e&&(e={}),this.elements.length){var r=this._getId(),i=document.querySelector("#"+y+r),n=this.toCSS(t,e);i?i.innerText=n:document.body.insertAdjacentHTML("beforeend",'<style id="'+y+"STYLE_"+r+'">'+n+"</style>")}},m.prototype.playCSS=function(t,e){var i=this;if(void 0===t&&(t=!0),void 0===e&&(e={}),!R||this.getPlayState()===I)return this;var r=this.elements,n=r.length;if(!n)return this;this.isEnded()&&this.setTime(0),t&&this.exportCSS();for(var o,s,a=Nt(e),u=0;u<n;++u){var f=r[u];f.style.cssText+=a,s=_,((o=f).classList?o.classList.contains(s):o.className.match(new RegExp("(\\s|^)"+s+"(\\s|$)")))?(kt(f,_),function(t){requestAnimationFrame(function(){requestAnimationFrame(function(){Ft(t,_)})})}(f)):Ft(f,_)}this.setState({playCSS:!0}),this.setPlayState(I),this.trigger(O);var h=this.getDuration(),p=r[0],c=function(){i.end(),p&&(p.removeEventListener("animationend",c),p.removeEventListener("animationiteration",m))},m=function(t){var e=t.elapsedTime,r=e/h;i.state.currentTime=e,i.setCurrentIterationCount(r)};return p.addEventListener("animationend",c),p.addEventListener("animationiteration",m),this},m.prototype._getId=function(){return this.state.id||this.setId().getId()},m.prototype._getEasing=function(t,e,r,i){if(this.keyframes.hasName(s)){var n=this._getNowValue(t,e,r,[s],0,!0);return"function"==typeof n?n:i}return i},m.prototype._toKeyframes=function(e,t){void 0===e&&(e=this.getDuration());var r=this._getId(),i=this.state,n=i[w],o=i[x],s=t?i[S]:0,a=t?i[E]:N,u=this.getAllTimes(!0,{duration:e,delay:s,direction:a,iterationCount:t&&o!==A?o:1,isCSS:!0}),f=u.keys,h=u.values,p=u.frames,c=f.length,m={},l=[];for(var v in p)m[v]=p[v].toCSS();if(!f.length)return"";s&&(l.push("0%{"+p[0]+"}"),a!==k&&a!==C||l.push(s/n/e*100-1e-5+"%{"+m[0]+"}")),f.forEach(function(t){l.push((s+t)/n/e*100+"%{"+m[h[t]]+"}")});var g=f[c-1];return(s+g)/n<e&&l.push("100%{"+m[h[g]]),"@"+z+" "+y+"KEYFRAMES_"+Ct(r)+"{\n\t\t\t"+l.join("\n")+"\n\t\t}"},m.prototype._getNowValue=function(t,e,r,i,n,o){void 0===n&&(n=this.getEasing()),void 0===o&&(o=X(d,i,!0));for(var s,a,u,f,h=this.keyframes,p=h.times,c=p.length,m=e;0<=m;--m){if((v=h.get(p[m])).has.apply(v,i)){s=p[m],u=v;break}}var l=u&&u.raw.apply(u,i);if(o)return l;for(m=r;m<c;++m){var v;if((v=h.get(p[m])).has.apply(v,i)){a=p[m],f=v;break}}var g=f&&f.raw.apply(f,i);return!u||et(l)?g:!f||et(g)||l===g?l:(s<0&&(s=0),function(t,e,r,i,n,o){if(t===e)return i;if(t===r)return n;if(!o)return _t(i,n,t-e,r-t);var s=o((t-e)/(r-e));return _t(i,n,s,1-s)}(t,s,a,l,g,n))},m.prototype._getNearTimeIndex=function(t){for(var e=this.keyframes.times,r=e.length,i=0;i<r;++i){if(e[i]===t)return{left:i,right:i};if(e[i]>t)return{left:0===i?0:i-1,right:i}}return{left:r-1,right:r-1}},m.prototype._animate=function(t){var e=this.getIterationTime(),r=this.getEasing()||t,i=this.getNowFrame(e,r),n=this.getTime();this.trigger("animate",{frame:i,currentTime:n,time:e});var o=this.elements,s=o.length;if(!s)return i;var a=i.get("attribute");if(a)for(var u in a)for(var f=0;f<s;++f)o[f].setAttribute(u,a[u]);var h=i.toCSS();if(this.state.cssText!==h){this.state.cssText=h;for(f=0;f<s;++f)o[f].style.cssText+=h;return i}},m}(ct),Mt=function(i){function s(t,e){var r=i.call(this)||this;return r.items={},r.load(t,e),r}return a(s,i),s.prototype.setId=function(t){return void 0===t&&(t="scene"+Math.floor(1e5*Math.random())),this.state.id=t,this},s.prototype.getId=function(){return this.state.id},s.prototype.getDuration=function(){var t=this.items,e=0;for(var r in t){var i=t[r];e=Math.max(e,i.getTotalDuration()/i.getPlaySpeed())}return e},s.prototype.setDuration=function(t){var e=this.items,r=this.getDuration();if(0===t||!isFinite(r))return this;if(0===r)for(var i in e){(o=e[i]).setDuration(t)}else{var n=t/r;for(var i in e){var o;(o=e[i]).setDelay(o.getDelay()*n),o.setDuration(o.getDuration()*n)}}return this},s.prototype.getItem=function(t){return this.items[t]},s.prototype.newItem=function(t,e){if(void 0===e&&(e={}),r=this.items,i=t,Object.prototype.hasOwnProperty.call(r,i))return this.items[t];var r,i,n=new At;return this.setItem(t,n),n.setOptions(e),n},s.prototype.setItem=function(t,e){return e instanceof ct&&e.setId(t),this.items[t]=e,this},s.prototype.animate=function(t,e){return i.prototype.setTime.call(this,t,!0),this._animate(e)},s.prototype.setTime=function(t,e,r){return i.prototype.setTime.call(this,t,e),this._animate(r),this},s.prototype.forEach=function(t){var e=this.items;for(var r in e)t(e[r],r,e);return this},s.prototype.exportCSS=function(t,e){void 0===t&&(t=this.getDuration());var r=this.items,i=t;for(var n in i&&isFinite(i)||(i=0),r){r[n].exportCSS(i,this.state)}return this},s.prototype.append=function(t){t.setDelay(t.getDelay()+this.getDuration()),this.setItem(t.getId()||t.setId().getId(),t)},s.prototype.playCSS=function(t,e){var i=this;if(void 0===t&&(t=!0),void 0===e&&(e={}),!R||this.getPlayState()===I)return this;t&&this.exportCSS();var r,n=this.items;for(var o in n){var s=n[o];s.playCSS(!1,e),s.getState("playCSS")&&(r=s)}if(!r)return this;var a=function(t){var e=t.currentTime,r=t.iterationCount;i.state.currentTime=e,i.setCurrentIterationCount(r)},u=function(){i.end(),i.setState({playCSS:!1}),r.off(m,u),r.off(b,a)};return r.on(m,u),r.on(b,a),this.setState({playCSS:!0}),this.setPlayState(I),this.trigger(O),this},s.prototype.load=function(t,e){if(void 0===t&&(t={}),void 0===e&&(e=t.options),!t)return this;var r=e&&e.selector;for(var i in t)if("options"!==i){var n=t[i],o=void 0;n instanceof s||n instanceof At?(this.setItem(i,n),o=n):(o=this.newItem(i)).load(n),r&&o.setSelector(i)}this.setOptions(e)},s.prototype.setSelector=function(t){var r=this.options.selector;this.forEach(function(t,e){t.setSelector(!!r&&e)})},s.prototype._animate=function(t){var e=this.getIterationTime(),r=this.items,i=this.getEasing()||t,n={};for(var o in r){var s=r[o];n[o]=s.animate(Math.max(e*s.getPlaySpeed()-s.getDelay(),0),i)}return this.trigger(g,{currentTime:this.getTime(),time:e,frames:n}),n},s}(ct);function jt(t,e,r){for(var i=new At({},r),n=e.length,o=0;o<n;++o)i.set(o/(n-1)*100+"%",t,e[o]);return i}var Pt={VERSION:"1.0.0-beta8",SceneItem:At,Frame:Ot,Animator:ct,Keyframes:It,PropertyObject:G,default:Mt,bezier:U,EASE_IN_OUT:B,EASE_IN:H,EASE_OUT:J,EASE:Z,LINEAR:Y,steps:q,STEP_START:K,STEP_END:$,set:jt,transition:function(t,e,r){var i,n,o=r.from,s=r.to,a=r.duration,u=void 0===a?t.getDuration():a,f=r.time,h=void 0===f?Math.max(t.getDuration()-u,0):f;t.set(((i={})[h]=o,i[h+u]=s,i)),e.set(((n={0:s})[u]=o,n))},wipeIn:function(t){var e=t.from,r=void 0===e?"-100%":e,i=t.to,n=void 0===i?"0%":i,o=t.property;return jt(void 0===o?"left":o,[r,n],t)},wipeOut:function(t){var e=t.from,r=void 0===e?"0%":e,i=t.to,n=void 0===i?"100%":i,o=t.property;return jt(void 0===o?"left":o,[r,n],t)},fadeIn:function(t){var e=t.from,r=void 0===e?0:e,i=t.to;return jt("opacity",[r,void 0===i?1:i],t)},fadeOut:function(t){var e=t.from,r=void 0===e?1:e,i=t.to;return jt("opacity",[r,void 0===i?0:i],t)},blink:function(t){var e=t.from,r=void 0===e?0:e,i=t.to;return jt("opacity",[r,void 0===i?1:i,r],t)},zoomIn:function(t){var e=t.from,r=void 0===e?0:e,i=t.to;return jt(["transform","scale"],[r,void 0===i?1:i],t)},zoomOut:function(t){var e=t.from,r=void 0===e?1:e,i=t.to;return jt(["transform","scale"],[r,void 0===i?0:i],t)},OPTIONS:t,EVENTS:e,setRole:function(t,e,r){for(var i=t.length,n=u,o=d,s=0;s<i-1;++s)!n[t[s]]&&(n[t[s]]={}),n=n[t[s]],r&&(!o[t[s]]&&(o[t[s]]={}),o=o[t[s]]);r&&(o[t[i-1]]=!0),n[t[i-1]]=!!e||{}},setAlias:function(t,e){h[t]=e}};for(var Lt in Pt)Mt[Lt]=Pt[Lt];return Mt});
//# sourceMappingURL=scene.min.js.map
